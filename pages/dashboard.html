<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard P√∫blico | HubBS - Dados Urbanos</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'deep-blue': '#005F73',
                        'vibrant-teal': '#0A9396',
                        'ods-green': '#94D2BD',
                        'solar-yellow': '#E9D8A6',
                        'warm-sand': '#FAF3E0',
                        'dark-gray': '#2E2E2E',
                    },
                    fontFamily: {
                        'poppins': ['Poppins', 'sans-serif'],
                        'roboto': ['Roboto', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    
    <style>
        body {
            font-family: 'Roboto', sans-serif;
        }
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Poppins', sans-serif;
        }
    </style>
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- Database Scripts -->
    <script src="../js/database.js"></script>
    <script src="../js/api.js"></script>
    <link rel="stylesheet" href="../assets/css/style.css">
    <script src="../assets/js/app.js" defer></script>
    <script src="../assets/js/dashboard.js" defer></script>
</head>

<body class="bg-warm-sand text-dark-gray">

    <!-- Header/Navbar -->
    <nav class="bg-deep-blue text-white shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <a href="../index.html" class="text-2xl font-bold font-poppins flex items-center gap-2">
                    <img src="../assets/img/logo.jpeg" alt="HubBS Logo" class="h-12 w-12 object-contain rounded">
                    HubBS
                </a>
                <div class="hidden md:flex items-center gap-6">
                    <a href="../index.html" class="hover:text-solar-yellow transition">In√≠cio</a>
                    <a href="sobre.html" class="hover:text-solar-yellow transition">Sobre</a>
                    <a href="enviar-relato.html" class="hover:text-solar-yellow transition">Enviar Relato</a>
                    <a href="whatsapp-bot.html" class="hover:text-solar-yellow transition"><i class="fab fa-whatsapp mr-1"></i>WhatsApp Bot</a>
                    <a href="dashboard.html" class="text-solar-yellow font-bold border-b-2 border-solar-yellow">Dashboard</a>
                    <a href="recompensas.html" class="hover:text-solar-yellow transition">Recompensas</a>
                    <a href="planos.html" class="hover:text-solar-yellow transition">Planos</a>
                    <a href="login.html" class="bg-vibrant-teal px-4 py-2 rounded-lg hover:bg-ods-green transition">Login</a>
                </div>
                <div class="md:hidden">
                    <button id="mobile-menu-button" class="text-white hover:text-solar-yellow focus:outline-none">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div id="mobile-menu" class="hidden md:hidden pt-4 pb-2">
                <a href="../index.html" class="block py-2 hover:text-solar-yellow transition">In√≠cio</a>
                <a href="sobre.html" class="block py-2 hover:text-solar-yellow transition">Sobre</a>
                <a href="enviar-relato.html" class="block py-2 hover:text-solar-yellow transition">Enviar Relato</a>
                <a href="whatsapp-bot.html" class="block py-2 hover:text-solar-yellow transition"><i class="fab fa-whatsapp mr-1"></i>WhatsApp Bot</a>
                <a href="dashboard.html" class="block py-2 text-solar-yellow font-bold">Dashboard</a>
                <a href="recompensas.html" class="block py-2 hover:text-solar-yellow transition">Recompensas</a>
                <a href="planos.html" class="block py-2 hover:text-solar-yellow transition">Planos</a>
                <a href="login.html" class="block py-2 bg-vibrant-teal px-4 rounded-lg text-center mt-2">Login</a>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="bg-gradient-to-br from-deep-blue to-vibrant-teal text-white py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h1 class="text-3xl md:text-5xl font-bold mb-4">Dashboard P√∫blico</h1>
            <p class="text-lg md:text-xl text-blue-100">
                Visualize dados em tempo real sobre a Baixada Santista
            </p>
        </div>
    </section>

    <!-- Quick Stats -->
    <section class="py-8 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="bg-gradient-to-br from-deep-blue to-vibrant-teal text-white p-6 rounded-xl shadow-lg text-center">
                    <div class="text-3xl md:text-4xl font-bold mb-2" id="stat-total">0</div>
                    <div class="text-sm text-blue-100">Total de Relatos</div>
                </div>
                <div class="bg-gradient-to-br from-green-600 to-emerald-600 text-white p-6 rounded-xl shadow-lg text-center">
                    <div class="text-3xl md:text-4xl font-bold mb-2" id="stat-resolvidos">0</div>
                    <div class="text-sm text-green-100">Resolvidos</div>
                </div>
                <div class="bg-gradient-to-br from-orange-500 to-yellow-500 text-white p-6 rounded-xl shadow-lg text-center">
                    <div class="text-3xl md:text-4xl font-bold mb-2" id="stat-analise">0</div>
                    <div class="text-sm text-orange-100">Em An√°lise</div>
                </div>
                <div class="bg-gradient-to-br from-purple-600 to-pink-600 text-white p-6 rounded-xl shadow-lg text-center">
                    <div class="text-3xl md:text-4xl font-bold mb-2" id="stat-taxa">0%</div>
                    <div class="text-sm text-purple-100">Taxa de Resolu√ß√£o</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Charts Section -->
    <section class="py-12 bg-warm-sand">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            
            <!-- Rankings Section -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                
                <!-- Ranking de Cidades -->
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold text-dark-gray">üèÜ Cidades Mais Ativas</h2>
                        <span class="text-sm text-gray-500">Por relatos enviados</span>
                    </div>
                    <div id="cities-ranking" class="space-y-3">
                        <!-- Ser√° preenchido dinamicamente -->
                        <div class="flex items-center justify-center py-8">
                            <i class="fas fa-spinner fa-spin text-3xl text-gray-400"></i>
                        </div>
                    </div>
                </div>

                <!-- Ranking de Cidad√£os -->
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold text-dark-gray">‚≠ê Cidad√£os Destaque</h2>
                        <span class="text-sm text-gray-500">Por pontos acumulados</span>
                    </div>
                    <div id="citizens-ranking" class="space-y-3">
                        <!-- Ser√° preenchido dinamicamente -->
                        <div class="flex items-center justify-center py-8">
                            <i class="fas fa-spinner fa-spin text-3xl text-gray-400"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Estat√≠sticas por ODS -->
            <div class="bg-white rounded-2xl shadow-lg p-6 mb-8">
                <h2 class="text-2xl font-bold text-dark-gray mb-6">üìä Distribui√ß√£o por ODS</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    
                    <!-- ODS 9 -->
                    <div class="bg-gradient-to-br from-orange-50 to-orange-100 p-6 rounded-xl border-2 border-orange-300">
                        <div class="flex items-center justify-between mb-4">
                            <div class="bg-orange-500 text-white w-12 h-12 rounded-full flex items-center justify-center font-bold text-lg">
                                9
                            </div>
                            <span class="text-3xl font-bold text-orange-700" id="ods9-count">0</span>
                        </div>
                        <h3 class="font-bold text-lg text-orange-900 mb-2">Ind√∫stria, Inova√ß√£o e Infraestrutura</h3>
                        <p class="text-sm text-orange-700 mb-3">Transporte, estradas, conectividade</p>
                        <div class="bg-orange-200 rounded-full h-2 overflow-hidden">
                            <div id="ods9-bar" class="bg-orange-600 h-full transition-all duration-500" style="width: 0%"></div>
                        </div>
                        <p class="text-xs text-orange-600 mt-2 text-right" id="ods9-percent">0%</p>
                    </div>

                    <!-- ODS 11 -->
                    <div class="bg-gradient-to-br from-green-50 to-green-100 p-6 rounded-xl border-2 border-green-300">
                        <div class="flex items-center justify-between mb-4">
                            <div class="bg-green-500 text-white w-12 h-12 rounded-full flex items-center justify-center font-bold text-lg">
                                11
                            </div>
                            <span class="text-3xl font-bold text-green-700" id="ods11-count">0</span>
                        </div>
                        <h3 class="font-bold text-lg text-green-900 mb-2">Cidades e Comunidades Sustent√°veis</h3>
                        <p class="text-sm text-green-700 mb-3">Espa√ßos p√∫blicos, saneamento, habita√ß√£o</p>
                        <div class="bg-green-200 rounded-full h-2 overflow-hidden">
                            <div id="ods11-bar" class="bg-green-600 h-full transition-all duration-500" style="width: 0%"></div>
                        </div>
                        <p class="text-xs text-green-600 mt-2 text-right" id="ods11-percent">0%</p>
                    </div>

                    <!-- ODS 13 -->
                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 p-6 rounded-xl border-2 border-blue-300">
                        <div class="flex items-center justify-between mb-4">
                            <div class="bg-blue-500 text-white w-12 h-12 rounded-full flex items-center justify-center font-bold text-lg">
                                13
                            </div>
                            <span class="text-3xl font-bold text-blue-700" id="ods13-count">0</span>
                        </div>
                        <h3 class="font-bold text-lg text-blue-900 mb-2">A√ß√£o Contra a Mudan√ßa Global do Clima</h3>
                        <p class="text-sm text-blue-700 mb-3">Res√≠duos, preserva√ß√£o, energia limpa</p>
                        <div class="bg-blue-200 rounded-full h-2 overflow-hidden">
                            <div id="ods13-bar" class="bg-blue-600 h-full transition-all duration-500" style="width: 0%"></div>
                        </div>
                        <p class="text-xs text-blue-600 mt-2 text-right" id="ods13-percent">0%</p>
                    </div>
                </div>
            </div>

            <!-- Map Section -->
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <h2 class="text-2xl font-bold text-dark-gray mb-6">Mapa de Calor - Baixada Santista</h2>
                <p class="text-gray-600 mb-4">
                    Regi√µes com maior volume de reclama√ß√µes
                </p>
                
                <!-- Simulated map -->
                <div class="bg-gradient-to-br from-sand to-turquoise/20 rounded-xl p-8 relative overflow-hidden" style="height: 400px;">
                    <div class="text-center text-gray-500 absolute inset-0 flex items-center justify-center">
                        <div>
                            <div class="text-6xl mb-4">üó∫Ô∏è</div>
                            <p class="text-lg font-semibold">Mapa Interativo da Baixada Santista</p>
                            <p class="text-sm mt-2">(Integra√ß√£o com Google Maps em desenvolvimento)</p>
                        </div>
                    </div>
                    
                    <!-- Simulated hotspots -->
                    <div class="absolute top-1/4 left-1/3 bg-red-500 rounded-full w-16 h-16 opacity-50 animate-pulse"></div>
                    <div class="absolute top-1/2 left-1/2 bg-orange-500 rounded-full w-12 h-12 opacity-50 animate-pulse"></div>
                    <div class="absolute top-2/3 left-2/3 bg-yellow-500 rounded-full w-10 h-10 opacity-50 animate-pulse"></div>
                </div>

                <!-- Cities Legend -->
                <div class="grid grid-cols-3 md:grid-cols-9 gap-4 mt-6">
                    <div class="text-center">
                        <div class="bg-red-500 w-8 h-8 rounded-full mx-auto mb-1"></div>
                        <span class="text-xs text-gray-600">Santos</span>
                        <p class="text-xs font-bold text-dark-gray">842</p>
                    </div>
                    <div class="text-center">
                        <div class="bg-orange-500 w-8 h-8 rounded-full mx-auto mb-1"></div>
                        <span class="text-xs text-gray-600">SV</span>
                        <p class="text-xs font-bold text-dark-gray">456</p>
                    </div>
                    <div class="text-center">
                        <div class="bg-yellow-500 w-8 h-8 rounded-full mx-auto mb-1"></div>
                        <span class="text-xs text-gray-600">Guaruj√°</span>
                        <p class="text-xs font-bold text-dark-gray">321</p>
                    </div>
                    <div class="text-center">
                        <div class="bg-green-500 w-8 h-8 rounded-full mx-auto mb-1"></div>
                        <span class="text-xs text-gray-600">Praia Gr.</span>
                        <p class="text-xs font-bold text-dark-gray">287</p>
                    </div>
                    <div class="text-center">
                        <div class="bg-blue-500 w-8 h-8 rounded-full mx-auto mb-1"></div>
                        <span class="text-xs text-gray-600">Cubat√£o</span>
                        <p class="text-xs font-bold text-dark-gray">198</p>
                    </div>
                    <div class="text-center">
                        <div class="bg-indigo-500 w-8 h-8 rounded-full mx-auto mb-1"></div>
                        <span class="text-xs text-gray-600">Itanha√©m</span>
                        <p class="text-xs font-bold text-dark-gray">156</p>
                    </div>
                    <div class="text-center">
                        <div class="bg-purple-500 w-8 h-8 rounded-full mx-auto mb-1"></div>
                        <span class="text-xs text-gray-600">Mongagu√°</span>
                        <p class="text-xs font-bold text-dark-gray">124</p>
                    </div>
                    <div class="text-center">
                        <div class="bg-pink-500 w-8 h-8 rounded-full mx-auto mb-1"></div>
                        <span class="text-xs text-gray-600">Peru√≠be</span>
                        <p class="text-xs font-bold text-dark-gray">98</p>
                    </div>
                    <div class="text-center">
                        <div class="bg-gray-500 w-8 h-8 rounded-full mx-auto mb-1"></div>
                        <span class="text-xs text-gray-600">Bertioga</span>
                        <p class="text-xs font-bold text-dark-gray">66</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Insights Section -->
    <section class="py-12 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-3xl font-bold text-dark-gray mb-8 text-center">Principais Insights</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-gradient-to-br from-sand to-turquoise/20 p-6 rounded-xl">
                    <div class="text-4xl mb-3">üèóÔ∏è</div>
                    <h3 class="text-xl font-bold text-dark-gray mb-2">Infraestrutura</h3>
                    <p class="text-gray-700 mb-2">
                        33% das reclama√ß√µes est√£o relacionadas a problemas de infraestrutura urbana.
                    </p>
                    <span class="text-sm text-deep-blue font-semibold">ODS 9, 11</span>
                </div>

                <div class="bg-gradient-to-br from-turquoise/20 to-sand p-6 rounded-xl">
                    <div class="text-4xl mb-3">üíß</div>
                    <h3 class="text-xl font-bold text-dark-gray mb-2">Saneamento</h3>
                    <p class="text-gray-700 mb-2">
                        28% das reclama√ß√µes envolvem quest√µes de √°gua e esgoto.
                    </p>
                    <span class="text-sm text-deep-blue font-semibold">ODS 6, 14</span>
                </div>

                <div class="bg-gradient-to-br from-sand to-turquoise/20 p-6 rounded-xl">
                    <div class="text-4xl mb-3">‚ö°</div>
                    <h3 class="text-xl font-bold text-dark-gray mb-2">Energia</h3>
                    <p class="text-gray-700 mb-2">
                        18% das reclama√ß√µes s√£o sobre ilumina√ß√£o p√∫blica e energia.
                    </p>
                    <span class="text-sm text-deep-blue font-semibold">ODS 7</span>
                </div>
            </div>
        </div>
    </section>

    <!-- CTA Section -->
    <section class="py-12 bg-gradient-to-r from-deep-blue to-vibrant-teal text-white">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h2 class="text-3xl font-bold mb-4">
                Quer acesso a dados mais detalhados?
            </h2>
            <p class="text-lg mb-6 text-blue-100">
                Empresas e investidores podem acessar relat√≥rios completos, filtros avan√ßados e simula√ß√µes de ROI
            </p>
            <a href="empresa.html" class="inline-block bg-white text-deep-blue px-8 py-3 rounded-full font-semibold hover:bg-sand transition shadow-xl">
                Acessar Painel de Empresas
            </a>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-dark-gray text-white py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8">
                <div>
                    <div class="flex items-center gap-2 mb-4">
                        <img src="../assets/img/logo.jpeg" alt="HubBS Logo" class="h-10 w-10 object-contain rounded">
                        <h3 class="text-xl font-bold text-turquoise">HubBS</h3>
                    </div>
                    <p class="text-gray-400">Dados urbanos inteligentes para a Baixada Santista</p>
                </div>
                <div>
                    <h3 class="text-lg font-bold mb-4">Navega√ß√£o</h3>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="../index.html" class="hover:text-turquoise transition">In√≠cio</a></li>
                        <li><a href="sobre.html" class="hover:text-turquoise transition">Sobre</a></li>
                        <li><a href="dashboard.html" class="hover:text-turquoise transition">Dashboard</a></li>
                        <li><a href="recompensas.html" class="hover:text-turquoise transition">Recompensas</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-bold mb-4">Para Empresas</h3>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="empresa.html" class="hover:text-turquoise transition">Painel de Dados</a></li>
                        <li><a href="login.html" class="hover:text-turquoise transition">Login</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-bold mb-4">Contato</h3>
                    <ul class="space-y-2 text-gray-400">
                        <li>üìß contato@HubBS.com.br</li>
                        <li>üì± (13) 99999-9999</li>
                        <li>üìç Santos, SP - Brasil</li>
                    </ul>
                </div>
            </div>
            <div class="border-t border-gray-700 pt-8 text-center text-gray-400">
                <p>&copy; 2025 HubBS - Hackathon Construinova. Todos os direitos reservados.</p>
                <p class="mt-2 text-sm">Alinhado com os Objetivos de Desenvolvimento Sustent√°vel da ONU</p>
            </div>
        </div>
    </footer>

    <script>
        const cidadeMap = {
            'santos': 'Santos',
            'sao-vicente': 'S√£o Vicente',
            'guaruja': 'Guaruj√°',
            'praia-grande': 'Praia Grande',
            'cubatao': 'Cubat√£o',
            'bertioga': 'Bertioga',
            'mongagua': 'Mongagu√°',
            'itanhaem': 'Itanha√©m',
            'peruibe': 'Peru√≠be'
        };

        const cidadeColors = {
            'santos': '#EF4444',
            'sao-vicente': '#F97316',
            'guaruja': '#F59E0B',
            'praia-grande': '#10B981',
            'cubatao': '#3B82F6',
            'bertioga': '#6366F1',
            'mongagua': '#8B5CF6',
            'itanhaem': '#EC4899',
            'peruibe': '#6B7280'
        };

        // Carregar dados do dashboard
        async function carregarDashboard() {
            try {
                // Aguardar inicializa√ß√£o do banco
                await new Promise(resolve => setTimeout(resolve, 1000));

                // Buscar dados
                const relatosResult = await window.hubAPI.buscarRelatos();
                const statsResult = await window.hubAPI.getEstatisticas();

                if (relatosResult.success && relatosResult.data) {
                    const relatos = relatosResult.data;
                    const stats = statsResult.data;

                    // Atualizar estat√≠sticas principais
                    atualizarEstatisticas(stats);

                    // Calcular e exibir rankings
                    calcularRankingCidades(relatos);
                    await calcularRankingCidadaos();

                    // Calcular ODS
                    calcularODS(relatos);
                }
            } catch (error) {
                console.error('Erro ao carregar dashboard:', error);
            }
        }

        // Atualizar estat√≠sticas principais
        function atualizarEstatisticas(stats) {
            document.getElementById('stat-total').textContent = stats.total || 0;
            document.getElementById('stat-resolvidos').textContent = stats.resolvidos || 0;
            document.getElementById('stat-analise').textContent = stats.emAnalise || 0;
            
            const taxa = stats.total > 0 ? Math.round((stats.resolvidos / stats.total) * 100) : 0;
            document.getElementById('stat-taxa').textContent = taxa + '%';
        }

        // Calcular ranking de cidades
        function calcularRankingCidades(relatos) {
            const cidadeStats = {};

            // Contar relatos por cidade
            relatos.forEach(relato => {
                const cidade = relato.cidade;
                if (!cidadeStats[cidade]) {
                    cidadeStats[cidade] = {
                        total: 0,
                        resolvidos: 0
                    };
                }
                cidadeStats[cidade].total++;
                if (relato.status === 'resolvido') {
                    cidadeStats[cidade].resolvidos++;
                }
            });

            // Converter para array e ordenar
            const ranking = Object.entries(cidadeStats)
                .map(([cidade, stats]) => ({
                    cidade,
                    total: stats.total,
                    resolvidos: stats.resolvidos,
                    taxa: stats.total > 0 ? (stats.resolvidos / stats.total * 100).toFixed(1) : 0
                }))
                .sort((a, b) => b.total - a.total)
                .slice(0, 9);

            renderizarRankingCidades(ranking);
        }

        // Renderizar ranking de cidades
        function renderizarRankingCidades(ranking) {
            const container = document.getElementById('cities-ranking');
            
            if (ranking.length === 0) {
                container.innerHTML = '<p class="text-center text-gray-500 py-8">Nenhum dado dispon√≠vel</p>';
                return;
            }

            container.innerHTML = ranking.map((item, index) => {
                const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}¬∫`;
                const color = cidadeColors[item.cidade] || '#6B7280';

                return `
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                        <div class="flex items-center gap-4 flex-1">
                            <span class="text-2xl w-12 text-center">${medal}</span>
                            <div class="flex-1">
                                <h3 class="font-bold text-lg" style="color: ${color};">${cidadeMap[item.cidade] || item.cidade}</h3>
                                <p class="text-sm text-gray-600">
                                    ${item.total} relatos ¬∑ ${item.resolvidos} resolvidos
                                </p>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-2xl font-bold text-deep-blue">${item.total}</div>
                            <div class="text-xs text-green-600 font-semibold">${item.taxa}% resolvidos</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Calcular ranking de cidad√£os
        async function calcularRankingCidadaos() {
            try {
                // Buscar usu√°rios do banco
                const usuarios = await window.hubDB.getUsuarios();
                
                if (!usuarios || usuarios.length === 0) {
                    document.getElementById('citizens-ranking').innerHTML = 
                        '<p class="text-center text-gray-500 py-8">Nenhum cidad√£o cadastrado ainda</p>';
                    return;
                }

                // Ordenar por pontos
                const ranking = usuarios
                    .filter(u => u.tipo === 'cidadao')
                    .sort((a, b) => (b.pontos || 0) - (a.pontos || 0))
                    .slice(0, 10);

                renderizarRankingCidadaos(ranking);
            } catch (error) {
                console.error('Erro ao calcular ranking de cidad√£os:', error);
            }
        }

        // Renderizar ranking de cidad√£os
        function renderizarRankingCidadaos(ranking) {
            const container = document.getElementById('citizens-ranking');
            
            if (ranking.length === 0) {
                container.innerHTML = '<p class="text-center text-gray-500 py-8">Nenhum cidad√£o ativo ainda</p>';
                return;
            }

            container.innerHTML = ranking.map((cidadao, index) => {
                const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}¬∫`;
                const pontos = cidadao.pontos || 0;
                const relatos = cidadao.relatosEnviados || 0;

                // Gerar iniciais do nome
                const iniciais = cidadao.nome.split(' ')
                    .map(n => n[0])
                    .join('')
                    .substring(0, 2)
                    .toUpperCase();

                // Cores para avatares
                const avatarColors = [
                    'bg-blue-500', 'bg-green-500', 'bg-purple-500', 'bg-pink-500', 
                    'bg-yellow-500', 'bg-red-500', 'bg-indigo-500', 'bg-teal-500',
                    'bg-orange-500', 'bg-cyan-500'
                ];
                const avatarColor = avatarColors[index % avatarColors.length];

                return `
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                        <div class="flex items-center gap-4 flex-1">
                            <span class="text-2xl w-12 text-center">${medal}</span>
                            <div class="${avatarColor} w-12 h-12 rounded-full flex items-center justify-center text-white font-bold">
                                ${iniciais}
                            </div>
                            <div class="flex-1">
                                <h3 class="font-bold text-lg text-gray-800">${cidadao.nome}</h3>
                                <p class="text-sm text-gray-600">
                                    <i class="fas fa-map-marker-alt mr-1"></i>${cidadeMap[cidadao.cidade] || cidadao.cidade}
                                </p>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-2xl font-bold text-deep-blue">${pontos}</div>
                            <div class="text-xs text-gray-600">${relatos} relatos</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Calcular distribui√ß√£o por ODS
        function calcularODS(relatos) {
            const odsCount = {
                'ods-9': 0,
                'ods-11': 0,
                'ods-13': 0
            };

            relatos.forEach(relato => {
                const ods = relato.ods;
                if (odsCount.hasOwnProperty(ods)) {
                    odsCount[ods]++;
                }
            });

            const total = relatos.length;

            // ODS 9
            const ods9Count = odsCount['ods-9'];
            const ods9Percent = total > 0 ? (ods9Count / total * 100).toFixed(1) : 0;
            document.getElementById('ods9-count').textContent = ods9Count;
            document.getElementById('ods9-percent').textContent = ods9Percent + '%';
            document.getElementById('ods9-bar').style.width = ods9Percent + '%';

            // ODS 11
            const ods11Count = odsCount['ods-11'];
            const ods11Percent = total > 0 ? (ods11Count / total * 100).toFixed(1) : 0;
            document.getElementById('ods11-count').textContent = ods11Count;
            document.getElementById('ods11-percent').textContent = ods11Percent + '%';
            document.getElementById('ods11-bar').style.width = ods11Percent + '%';

            // ODS 13
            const ods13Count = odsCount['ods-13'];
            const ods13Percent = total > 0 ? (ods13Count / total * 100).toFixed(1) : 0;
            document.getElementById('ods13-count').textContent = ods13Count;
            document.getElementById('ods13-percent').textContent = ods13Percent + '%';
            document.getElementById('ods13-bar').style.width = ods13Percent + '%';
        }

        // Inicializar dashboard ao carregar
        window.addEventListener('load', () => {
            carregarDashboard();
        });
    </script>
</body>

</html>

