<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M√©tricas ODS | HubBS - Construindo o Amanh√£</title>
    <meta name="description" content="An√°lise detalhada de m√©tricas dos Objetivos de Desenvolvimento Sustent√°vel">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'deep-blue': '#005F73',
                        'vibrant-teal': '#0A9396',
                        'ods-green': '#94D2BD',
                        'solar-yellow': '#E9D8A6',
                        'warm-sand': '#FAF3E0',
                        'dark-gray': '#2E2E2E',
                        'ods-6': '#26BDE2',
                        'ods-7': '#FCC30B',
                        'ods-9': '#FF6B35',
                        'ods-11': '#FFB627',
                        'ods-12': '#BF8B2E',
                        'ods-13': '#3C6E47',
                    },
                    fontFamily: {
                        'poppins': ['Poppins', 'sans-serif'],
                        'roboto': ['Roboto', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- jsPDF e autoTable para exporta√ß√£o PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    
    <!-- SheetJS para exporta√ß√£o Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        body {
            font-family: 'Roboto', sans-serif;
        }
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Poppins', sans-serif;
        }
        .ods-filter-btn.active {
            background: linear-gradient(135deg, #005F73, #0A9396);
            color: white;
            border-color: #005F73;
        }
        .metric-card {
            transition: all 0.3s ease;
        }
        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .filter-tag {
            background: linear-gradient(135deg, #0A9396, #94D2BD);
            color: white;
            padding: 0.375rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        .filter-tag button {
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            width: 1rem;
            height: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.625rem;
        }
        .filter-tag button:hover {
            background: rgba(255,255,255,0.5);
        }
        #active-filters.show {
            display: flex !important;
        }
    </style>
    
    <!-- Sistema de Logout Universal -->
    <script src="../../assets/js/logout.js"></script>
</head>

<body class="bg-warm-sand">
    <!-- Header/Navbar -->
    <nav class="bg-deep-blue text-white shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-6 py-4">
            <div class="flex justify-between items-center">
                <!-- Logo -->
                <a href="../../index.html" class="flex items-center space-x-2 hover:opacity-80 transition">
                    <img src="../../assets/img/logo.jpeg" alt="HubBS Logo" class="h-10 w-10 object-contain rounded">
                    <span class="text-2xl font-bold font-poppins">HubBS</span>
                    <span class="bg-solar-yellow text-deep-blue px-3 py-1 rounded-full text-xs font-bold">EMPRESA</span>
                </a>

                <!-- Desktop Menu -->
                <div class="hidden md:flex items-center space-x-6">
                    <a href="empresa-dashboard.html" class="hover:text-solar-yellow transition font-medium">Dashboard</a>
                    <a href="metricas-ods.html" class="text-solar-yellow border-b-2 border-solar-yellow font-bold">M√©tricas ODS</a>
                    <a href="relatorios.html" class="hover:text-solar-yellow transition font-medium">Relat√≥rios</a>
                    <span id="welcome-message" class="text-sm text-ods-green">Bem-vindo(a)!</span>
                    <button id="logout-btn" class="bg-red-500 px-6 py-2 rounded-full hover:bg-red-600 transition font-semibold">
                        Sair
                    </button>
                </div>

                <!-- Mobile Menu Button -->
                <button id="mobile-menu-btn" class="md:hidden text-white focus:outline-none">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>

            <!-- Mobile Menu -->
            <div id="mobile-menu" class="hidden md:hidden mt-4 pb-4">
                <a href="empresa-dashboard.html" class="block py-2 hover:text-solar-yellow transition">Dashboard</a>
                <a href="metricas-ods.html" class="block py-2 text-solar-yellow font-bold">M√©tricas ODS</a>
                <a href="relatorios.html" class="block py-2 hover:text-solar-yellow transition">Relat√≥rios</a>
                <span id="welcome-message-mobile" class="block py-2 text-ods-green text-sm">Bem-vindo(a)!</span>
                <button id="logout-btn-mobile" class="block w-full py-2 bg-red-500 rounded-lg hover:bg-red-600 transition mt-2">
                    Sair
                </button>
            </div>
        </div>
    </nav>

    <!-- Page Header -->
    <section class="bg-gradient-to-r from-deep-blue via-vibrant-teal to-deep-blue text-white py-20">
        <div class="container mx-auto px-6">
            <div class="max-w-6xl mx-auto text-center">
                <div class="inline-block bg-white/10 backdrop-blur-sm px-6 py-2 rounded-full mb-6">
                    <p class="text-sm font-semibold">üåç OBJETIVOS DE DESENVOLVIMENTO SUSTENT√ÅVEL</p>
                </div>
                <h1 class="text-5xl md:text-6xl font-extrabold font-poppins mb-6 leading-tight">
                    M√©tricas ODS em<br/>Tempo Real
                </h1>
                <p class="text-xl md:text-2xl mb-10 opacity-90">Acompanhe o impacto das a√ß√µes sustent√°veis na Baixada Santista</p>
                
                <!-- ODS Badges com Destaque -->
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 max-w-5xl mx-auto">
                    <div class="bg-white/10 backdrop-blur-md hover:bg-white/20 transition-all duration-300 p-4 rounded-xl border-2 border-white/20 hover:border-ods-6 hover:scale-105 cursor-pointer group">
                        <div class="text-4xl mb-2">üíß</div>
                        <div class="text-xs font-bold mb-1">ODS 6</div>
                        <div class="text-xs opacity-80 group-hover:opacity-100">√Ågua Limpa</div>
                    </div>
                    
                    <div class="bg-white/10 backdrop-blur-md hover:bg-white/20 transition-all duration-300 p-4 rounded-xl border-2 border-white/20 hover:border-ods-7 hover:scale-105 cursor-pointer group">
                        <div class="text-4xl mb-2">‚ö°</div>
                        <div class="text-xs font-bold mb-1">ODS 7</div>
                        <div class="text-xs opacity-80 group-hover:opacity-100">Energia Limpa</div>
                    </div>
                    
                    <div class="bg-white/10 backdrop-blur-md hover:bg-white/20 transition-all duration-300 p-4 rounded-xl border-2 border-white/20 hover:border-ods-9 hover:scale-105 cursor-pointer group">
                        <div class="text-4xl mb-2">üèóÔ∏è</div>
                        <div class="text-xs font-bold mb-1">ODS 9</div>
                        <div class="text-xs opacity-80 group-hover:opacity-100">Inova√ß√£o</div>
                    </div>
                    
                    <div class="bg-white/10 backdrop-blur-md hover:bg-white/20 transition-all duration-300 p-4 rounded-xl border-2 border-white/20 hover:border-ods-11 hover:scale-105 cursor-pointer group">
                        <div class="text-4xl mb-2">üèôÔ∏è</div>
                        <div class="text-xs font-bold mb-1">ODS 11</div>
                        <div class="text-xs opacity-80 group-hover:opacity-100">Cidades</div>
                    </div>
                    
                    <div class="bg-white/10 backdrop-blur-md hover:bg-white/20 transition-all duration-300 p-4 rounded-xl border-2 border-white/20 hover:border-ods-12 hover:scale-105 cursor-pointer group">
                        <div class="text-4xl mb-2">‚ôªÔ∏è</div>
                        <div class="text-xs font-bold mb-1">ODS 12</div>
                        <div class="text-xs opacity-80 group-hover:opacity-100">Consumo</div>
                    </div>
                    
                    <div class="bg-white/10 backdrop-blur-md hover:bg-white/20 transition-all duration-300 p-4 rounded-xl border-2 border-white/20 hover:border-ods-13 hover:scale-105 cursor-pointer group">
                        <div class="text-4xl mb-2">üå±</div>
                        <div class="text-xs font-bold mb-1">ODS 13</div>
                        <div class="text-xs opacity-80 group-hover:opacity-100">Clima</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Filters -->
    <section class="py-8 bg-white shadow-md sticky top-16 z-40">
        <div class="container mx-auto px-6">
            <h3 class="font-bold text-lg text-deep-blue mb-4">üîç Filtros de An√°lise</h3>
            
            <!-- Filter Grid -->
            <div class="grid md:grid-cols-3 gap-6">
                <!-- ODS Filter -->
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Objetivos ODS:</label>
                    <div class="flex flex-wrap gap-2">
                        <button class="ods-filter-btn active px-4 py-2 rounded-full border-2 border-gray-300 hover:border-deep-blue transition text-sm font-semibold" data-ods="all">
                            ‚ú® Todos
                        </button>
                        <button class="ods-filter-btn px-4 py-2 rounded-full border-2 border-gray-300 hover:border-ods-6 transition text-sm font-semibold" data-ods="ods-6">
                            üíß ODS 6
                        </button>
                        <button class="ods-filter-btn px-4 py-2 rounded-full border-2 border-gray-300 hover:border-ods-7 transition text-sm font-semibold" data-ods="ods-7">
                            ‚ö° ODS 7
                        </button>
                        <button class="ods-filter-btn px-4 py-2 rounded-full border-2 border-gray-300 hover:border-ods-9 transition text-sm font-semibold" data-ods="ods-9">
                            üèóÔ∏è ODS 9
                        </button>
                        <button class="ods-filter-btn px-4 py-2 rounded-full border-2 border-gray-300 hover:border-ods-11 transition text-sm font-semibold" data-ods="ods-11">
                            üèôÔ∏è ODS 11
                        </button>
                        <button class="ods-filter-btn px-4 py-2 rounded-full border-2 border-gray-300 hover:border-ods-12 transition text-sm font-semibold" data-ods="ods-12">
                            ‚ôªÔ∏è ODS 12
                        </button>
                        <button class="ods-filter-btn px-4 py-2 rounded-full border-2 border-gray-300 hover:border-ods-13 transition text-sm font-semibold" data-ods="ods-13">
                            üå± ODS 13
                        </button>
                    </div>
                </div>

                <!-- City Filter -->
                <div>
                    <label for="city-filter" class="block text-sm font-semibold text-gray-700 mb-2">Cidades da Baixada Santista:</label>
                    <select id="city-filter" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-deep-blue outline-none font-semibold text-sm">
                        <option value="all">üåä Todas as Cidades</option>
                        <option value="santos">Santos</option>
                        <option value="sao-vicente">S√£o Vicente</option>
                        <option value="guaruja">Guaruj√°</option>
                        <option value="praia-grande">Praia Grande</option>
                        <option value="cubatao">Cubat√£o</option>
                        <option value="bertioga">Bertioga</option>
                        <option value="mongagua">Mongagu√°</option>
                        <option value="itanhaem">Itanha√©m</option>
                        <option value="peruibe">Peru√≠be</option>
                    </select>
                </div>

                <!-- Period Filter -->
                <div>
                    <label for="period-filter" class="block text-sm font-semibold text-gray-700 mb-2">Per√≠odo de An√°lise:</label>
                    <select id="period-filter" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-deep-blue outline-none font-semibold text-sm">
                        <option value="week">üìÖ √öltima semana</option>
                        <option value="month" selected>üìÖ √öltimo m√™s</option>
                        <option value="quarter">üìÖ √öltimo trimestre</option>
                        <option value="year">üìÖ √öltimo ano</option>
                        <option value="all-time">üìÖ Todo o per√≠odo</option>
                    </select>
                </div>
            </div>

            <!-- Active Filters Display -->
            <div id="active-filters" class="mt-4 flex flex-wrap gap-2 items-center hidden">
                <span class="text-sm font-semibold text-gray-600">Filtros ativos:</span>
                <div id="filter-tags" class="flex flex-wrap gap-2"></div>
                <button id="clear-filters" class="text-sm text-red-600 hover:text-red-800 font-semibold ml-2">
                    ‚úï Limpar todos
                </button>
            </div>
        </div>
    </section>

    <!-- Results Summary -->
    <section class="py-4 bg-gray-50">
        <div class="container mx-auto px-6">
            <div class="flex items-center justify-between">
                <p class="text-sm text-gray-600">
                    Mostrando <span id="results-count" class="font-bold text-deep-blue">1,163</span> relatos
                    <span id="filter-description" class="text-gray-500"></span>
                </p>
                <button id="refresh-data" class="text-sm text-vibrant-teal hover:text-deep-blue font-semibold flex items-center gap-2">
                    üîÑ Atualizar dados
                </button>
            </div>
        </div>
    </section>

    <!-- Summary Cards -->
    <section class="py-12">
        <div class="container mx-auto px-6">
            <h2 class="text-4xl font-extrabold font-poppins text-deep-blue mb-3 text-center">üìä Resumo Geral por ODS</h2>
            <p class="text-center text-gray-600 mb-10">Acompanhe o desempenho de cada Objetivo de Desenvolvimento Sustent√°vel</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12">
                <!-- ODS 6 Summary -->
                <div class="bg-gradient-to-br from-ods-6 to-blue-600 text-white p-8 rounded-2xl shadow-xl metric-card transform hover:shadow-2xl">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-6xl">üíß</div>
                        <div class="text-right">
                            <div class="text-lg font-bold opacity-90">ODS 6</div>
                            <div class="text-xs opacity-75">√Ågua Limpa e Saneamento</div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="text-sm opacity-90 mb-1">ODS 6 - √Ågua Limpa e Saneamento</div>
                        <div class="text-5xl font-extrabold" id="ods6-total">156</div>
                    </div>
                    <p class="text-sm opacity-90 mb-4">Relatos categorizados</p>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <div class="opacity-75">‚úÖ Resolvidos</div>
                            <div class="font-bold text-xl" id="ods6-resolved">124</div>
                        </div>
                        <div>
                            <div class="opacity-75">‚è≥ Em andamento</div>
                            <div class="font-bold text-xl" id="ods6-pending">32</div>
                        </div>
                    </div>
                </div>

                <!-- ODS 7 Summary -->
                <div class="bg-gradient-to-br from-ods-7 to-yellow-600 text-white p-8 rounded-2xl shadow-xl metric-card transform hover:shadow-2xl">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-6xl">‚ö°</div>
                        <div class="text-right">
                            <div class="text-lg font-bold opacity-90">ODS 7</div>
                            <div class="text-xs opacity-75">Energia Limpa e Acess√≠vel</div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="text-sm opacity-90 mb-1">ODS 7 - Energia Limpa e Acess√≠vel</div>
                        <div class="text-5xl font-extrabold" id="ods7-total">203</div>
                    </div>
                    <p class="text-sm opacity-90 mb-4">Relatos categorizados</p>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <div class="opacity-75">‚úÖ Resolvidos</div>
                            <div class="font-bold text-xl" id="ods7-resolved">167</div>
                        </div>
                        <div>
                            <div class="opacity-75">‚è≥ Em andamento</div>
                            <div class="font-bold text-xl" id="ods7-pending">36</div>
                        </div>
                    </div>
                </div>

                <!-- ODS 9 Summary -->
                <div class="bg-gradient-to-br from-ods-9 to-orange-600 text-white p-8 rounded-2xl shadow-xl metric-card transform hover:shadow-2xl">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-6xl">üèóÔ∏è</div>
                        <div class="text-right">
                            <div class="text-lg font-bold opacity-90">ODS 9</div>
                            <div class="text-xs opacity-75">Inova√ß√£o e Infraestrutura</div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="text-sm opacity-90 mb-1">ODS 9 - Inova√ß√£o e Infraestrutura</div>
                        <div class="text-5xl font-extrabold" id="ods9-total">347</div>
                    </div>
                    <p class="text-sm opacity-90 mb-4">Relatos categorizados</p>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <div class="opacity-75">‚úÖ Resolvidos</div>
                            <div class="font-bold text-xl" id="ods9-resolved">289</div>
                        </div>
                        <div>
                            <div class="opacity-75">‚è≥ Em andamento</div>
                            <div class="font-bold text-xl" id="ods9-pending">58</div>
                        </div>
                    </div>
                </div>

                <!-- ODS 11 Summary -->
                <div class="bg-gradient-to-br from-ods-11 to-yellow-600 text-white p-8 rounded-2xl shadow-xl metric-card transform hover:shadow-2xl">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-6xl">üèôÔ∏è</div>
                        <div class="text-right">
                            <div class="text-lg font-bold opacity-90">ODS 11</div>
                            <div class="text-xs opacity-75">Cidades Sustent√°veis</div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="text-sm opacity-90 mb-1">ODS 11 - Cidades Sustent√°veis</div>
                        <div class="text-5xl font-extrabold" id="ods11-total">582</div>
                    </div>
                    <p class="text-sm opacity-90 mb-4">Relatos categorizados</p>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <div class="opacity-75">‚úÖ Resolvidos</div>
                            <div class="font-bold text-xl" id="ods11-resolved">461</div>
                        </div>
                        <div>
                            <div class="opacity-75">‚è≥ Em andamento</div>
                            <div class="font-bold text-xl" id="ods11-pending">121</div>
                        </div>
                    </div>
                </div>

                <!-- ODS 12 Summary -->
                <div class="bg-gradient-to-br from-ods-12 to-amber-700 text-white p-8 rounded-2xl shadow-xl metric-card transform hover:shadow-2xl">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-6xl">‚ôªÔ∏è</div>
                        <div class="text-right">
                            <div class="text-lg font-bold opacity-90">ODS 12</div>
                            <div class="text-xs opacity-75">Consumo Respons√°vel</div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="text-sm opacity-90 mb-1">ODS 12 - Consumo Respons√°vel</div>
                        <div class="text-5xl font-extrabold" id="ods12-total">289</div>
                    </div>
                    <p class="text-sm opacity-90 mb-4">Relatos categorizados</p>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <div class="opacity-75">‚úÖ Resolvidos</div>
                            <div class="font-bold text-xl" id="ods12-resolved">231</div>
                        </div>
                        <div>
                            <div class="opacity-75">‚è≥ Em andamento</div>
                            <div class="font-bold text-xl" id="ods12-pending">58</div>
                        </div>
                    </div>
                </div>

                <!-- ODS 13 Summary -->
                <div class="bg-gradient-to-br from-ods-13 to-green-700 text-white p-8 rounded-2xl shadow-xl metric-card transform hover:shadow-2xl">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-6xl">üå±</div>
                        <div class="text-right">
                            <div class="text-lg font-bold opacity-90">ODS 13</div>
                            <div class="text-xs opacity-75">A√ß√£o Clim√°tica</div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="text-sm opacity-90 mb-1">ODS 13 - A√ß√£o Clim√°tica</div>
                        <div class="text-5xl font-extrabold" id="ods13-total">234</div>
                    </div>
                    <p class="text-sm opacity-90 mb-4">Relatos categorizados</p>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <div class="opacity-75">‚úÖ Resolvidos</div>
                            <div class="font-bold text-xl" id="ods13-resolved">178</div>
                        </div>
                        <div>
                            <div class="opacity-75">‚è≥ Em andamento</div>
                            <div class="font-bold text-xl" id="ods13-pending">56</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Detailed Metrics -->
            <h2 class="text-4xl font-extrabold font-poppins text-deep-blue mb-3 text-center">üìà M√©tricas Detalhadas por Categoria</h2>
            <p class="text-center text-gray-600 mb-10">An√°lise aprofundada de cada ODS com gr√°ficos e subcategorias</p>

            <!-- ODS 9 Detailed -->
            <div class="metric-section mb-12" data-ods="ods-9">
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                    <div class="bg-gradient-to-r from-ods-9 to-orange-600 text-white p-6">
                        <div class="flex items-center gap-4">
                            <div class="text-5xl">üèóÔ∏è</div>
                            <div>
                                <h3 class="text-2xl font-bold font-poppins">ODS 9 - Ind√∫stria, Inova√ß√£o e Infraestrutura</h3>
                                <p class="text-sm opacity-90">Construir infraestruturas resilientes, promover a industrializa√ß√£o inclusiva e sustent√°vel e fomentar a inova√ß√£o</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-8">
                        <div class="grid md:grid-cols-2 gap-8 mb-8">
                            <!-- Chart -->
                            <div>
                                <h4 class="font-bold text-lg mb-4 text-deep-blue">Distribui√ß√£o de Relatos</h4>
                                <canvas id="chart-ods9" height="100"></canvas>
                            </div>
                            
                            <!-- Categories -->
                            <div>
                                <h4 class="font-bold text-lg mb-2 text-deep-blue">Categorias Principais</h4>
                                <div class="bg-gradient-to-r from-ods-9/10 to-orange-100 p-4 rounded-lg mb-4">
                                    <div class="text-sm text-gray-600 mb-1">ODS 9 - Total de Relatos</div>
                                    <div class="text-5xl font-bold text-ods-9">347</div>
                                </div>
                                <div class="space-y-4">
                                    <div class="border-l-4 border-ods-9 pl-4 py-2">
                                        <div class="flex justify-between items-center mb-1">
                                            <span class="font-semibold">Infraestrutura de Transporte</span>
                                            <span class="text-ods-9 font-bold">142</span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-2">
                                            <div class="bg-ods-9 h-2 rounded-full" style="width: 41%"></div>
                                        </div>
                                    </div>
                                    
                                    <div class="border-l-4 border-ods-9 pl-4 py-2">
                                        <div class="flex justify-between items-center mb-1">
                                            <span class="font-semibold">Saneamento B√°sico</span>
                                            <span class="text-ods-9 font-bold">98</span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-2">
                                            <div class="bg-ods-9 h-2 rounded-full" style="width: 28%"></div>
                                        </div>
                                    </div>
                                    
                                    <div class="border-l-4 border-ods-9 pl-4 py-2">
                                        <div class="flex justify-between items-center mb-1">
                                            <span class="font-semibold">Telecomunica√ß√µes</span>
                                            <span class="text-ods-9 font-bold">67</span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-2">
                                            <div class="bg-ods-9 h-2 rounded-full" style="width: 19%"></div>
                                        </div>
                                    </div>
                                    
                                    <div class="border-l-4 border-ods-9 pl-4 py-2">
                                        <div class="flex justify-between items-center mb-1">
                                            <span class="font-semibold">Energia e Ilumina√ß√£o</span>
                                            <span class="text-ods-9 font-bold">40</span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-2">
                                            <div class="bg-ods-9 h-2 rounded-full" style="width: 12%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Recent Reports -->
                        <div>
                            <h4 class="font-bold text-lg mb-4 text-deep-blue">Relatos Recentes</h4>
                            <div class="space-y-3">
                                <div class="flex items-start gap-4 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                                    <div class="text-2xl">üöß</div>
                                    <div class="flex-1">
                                        <div class="font-semibold text-sm mb-1">Buraco na Avenida Conselheiro N√©bias</div>
                                        <div class="text-xs text-gray-600">Categoria: Infraestrutura de Transporte ‚Ä¢ h√° 2 horas</div>
                                    </div>
                                    <span class="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-xs font-bold">Em an√°lise</span>
                                </div>
                                
                                <div class="flex items-start gap-4 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                                    <div class="text-2xl">üíß</div>
                                    <div class="flex-1">
                                        <div class="font-semibold text-sm mb-1">Vazamento de √°gua na Rua da Praia</div>
                                        <div class="text-xs text-gray-600">Categoria: Saneamento B√°sico ‚Ä¢ h√° 5 horas</div>
                                    </div>
                                    <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-xs font-bold">Resolvido</span>
                                </div>
                                
                                <div class="flex items-start gap-4 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                                    <div class="text-2xl">üí°</div>
                                    <div class="flex-1">
                                        <div class="font-semibold text-sm mb-1">Poste de ilumina√ß√£o apagado no Centro</div>
                                        <div class="text-xs text-gray-600">Categoria: Energia e Ilumina√ß√£o ‚Ä¢ h√° 1 dia</div>
                                    </div>
                                    <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-xs font-bold">Em progresso</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ODS 11 Detailed -->
            <div class="metric-section mb-12" data-ods="ods-11">
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                    <div class="bg-gradient-to-r from-ods-11 to-yellow-600 text-white p-6">
                        <div class="flex items-center gap-4">
                            <div class="text-5xl">üèôÔ∏è</div>
                            <div>
                                <h3 class="text-2xl font-bold font-poppins">ODS 11 - Cidades e Comunidades Sustent√°veis</h3>
                                <p class="text-sm opacity-90">Tornar as cidades e os assentamentos humanos inclusivos, seguros, resilientes e sustent√°veis</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-8">
                        <div class="grid md:grid-cols-2 gap-8 mb-8">
                            <!-- Chart -->
                            <div>
                                <h4 class="font-bold text-lg mb-4 text-deep-blue">Distribui√ß√£o de Relatos</h4>
                                <canvas id="chart-ods11" height="100"></canvas>
                            </div>
                            
                            <!-- Categories -->
                            <div>
                                <h4 class="font-bold text-lg mb-2 text-deep-blue">Categorias Principais</h4>
                                <div class="bg-gradient-to-r from-ods-11/10 to-yellow-100 p-4 rounded-lg mb-4">
                                    <div class="text-sm text-gray-600 mb-1">ODS 11 - Total de Relatos</div>
                                    <div class="text-5xl font-bold text-ods-11">582</div>
                                </div>
                                <div class="space-y-4">
                                    <div class="border-l-4 border-ods-11 pl-4 py-2">
                                        <div class="flex justify-between items-center mb-1">
                                            <span class="font-semibold">Espa√ßos P√∫blicos</span>
                                            <span class="text-ods-11 font-bold">187</span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-2">
                                            <div class="bg-ods-11 h-2 rounded-full" style="width: 32%"></div>
                                        </div>
                                    </div>
                                    
                                    <div class="border-l-4 border-ods-11 pl-4 py-2">
                                        <div class="flex justify-between items-center mb-1">
                                            <span class="font-semibold">Limpeza Urbana</span>
                                            <span class="text-ods-11 font-bold">156</span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-2">
                                            <div class="bg-ods-11 h-2 rounded-full" style="width: 27%"></div>
                                        </div>
                                    </div>
                                    
                                    <div class="border-l-4 border-ods-11 pl-4 py-2">
                                        <div class="flex justify-between items-center mb-1">
                                            <span class="font-semibold">Mobilidade Urbana</span>
                                            <span class="text-ods-11 font-bold">134</span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-2">
                                            <div class="bg-ods-11 h-2 rounded-full" style="width: 23%"></div>
                                        </div>
                                    </div>
                                    
                                    <div class="border-l-4 border-ods-11 pl-4 py-2">
                                        <div class="flex justify-between items-center mb-1">
                                            <span class="font-semibold">Seguran√ßa P√∫blica</span>
                                            <span class="text-ods-11 font-bold">105</span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-2">
                                            <div class="bg-ods-11 h-2 rounded-full" style="width: 18%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Recent Reports -->
                        <div>
                            <h4 class="font-bold text-lg mb-4 text-deep-blue">Relatos Recentes</h4>
                            <div class="space-y-3">
                                <div class="flex items-start gap-4 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                                    <div class="text-2xl">üóëÔ∏è</div>
                                    <div class="flex-1">
                                        <div class="font-semibold text-sm mb-1">Ac√∫mulo de lixo na orla da praia</div>
                                        <div class="text-xs text-gray-600">Categoria: Limpeza Urbana ‚Ä¢ h√° 1 hora</div>
                                    </div>
                                    <span class="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-xs font-bold">Em an√°lise</span>
                                </div>
                                
                                <div class="flex items-start gap-4 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                                    <div class="text-2xl">üå≥</div>
                                    <div class="flex-1">
                                        <div class="font-semibold text-sm mb-1">Pra√ßa sem manuten√ß√£o no Boqueir√£o</div>
                                        <div class="text-xs text-gray-600">Categoria: Espa√ßos P√∫blicos ‚Ä¢ h√° 3 horas</div>
                                    </div>
                                    <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-xs font-bold">Em progresso</span>
                                </div>
                                
                                <div class="flex items-start gap-4 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                                    <div class="text-2xl">üöå</div>
                                    <div class="flex-1">
                                        <div class="font-semibold text-sm mb-1">Ponto de √¥nibus danificado</div>
                                        <div class="text-xs text-gray-600">Categoria: Mobilidade Urbana ‚Ä¢ h√° 6 horas</div>
                                    </div>
                                    <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-xs font-bold">Resolvido</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ODS 13 Detailed -->
            <div class="metric-section mb-12" data-ods="ods-13">
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                    <div class="bg-gradient-to-r from-ods-13 to-green-700 text-white p-6">
                        <div class="flex items-center gap-4">
                            <div class="text-5xl">üå±</div>
                            <div>
                                <h3 class="text-2xl font-bold font-poppins">ODS 13 - A√ß√£o Contra a Mudan√ßa Global do Clima</h3>
                                <p class="text-sm opacity-90">Tomar medidas urgentes para combater a mudan√ßa clim√°tica e seus impactos</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-8">
                        <div class="grid md:grid-cols-2 gap-8 mb-8">
                            <!-- Chart -->
                            <div>
                                <h4 class="font-bold text-lg mb-4 text-deep-blue">Distribui√ß√£o de Relatos</h4>
                                <canvas id="chart-ods13" height="100"></canvas>
                            </div>
                            
                            <!-- Categories -->
                            <div>
                                <h4 class="font-bold text-lg mb-2 text-deep-blue">Categorias Principais</h4>
                                <div class="bg-gradient-to-r from-ods-13/10 to-green-100 p-4 rounded-lg mb-4">
                                    <div class="text-sm text-gray-600 mb-1">ODS 13 - Total de Relatos</div>
                                    <div class="text-5xl font-bold text-ods-13">234</div>
                                </div>
                                <div class="space-y-4">
                                    <div class="border-l-4 border-ods-13 pl-4 py-2">
                                        <div class="flex justify-between items-center mb-1">
                                            <span class="font-semibold">√Åreas Verdes</span>
                                            <span class="text-ods-13 font-bold">89</span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-2">
                                            <div class="bg-ods-13 h-2 rounded-full" style="width: 38%"></div>
                                        </div>
                                    </div>
                                    
                                    <div class="border-l-4 border-ods-13 pl-4 py-2">
                                        <div class="flex justify-between items-center mb-1">
                                            <span class="font-semibold">Polui√ß√£o Ambiental</span>
                                            <span class="text-ods-13 font-bold">67</span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-2">
                                            <div class="bg-ods-13 h-2 rounded-full" style="width: 29%"></div>
                                        </div>
                                    </div>
                                    
                                    <div class="border-l-4 border-ods-13 pl-4 py-2">
                                        <div class="flex justify-between items-center mb-1">
                                            <span class="font-semibold">Gest√£o de Res√≠duos</span>
                                            <span class="text-ods-13 font-bold">48</span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-2">
                                            <div class="bg-ods-13 h-2 rounded-full" style="width: 21%"></div>
                                        </div>
                                    </div>
                                    
                                    <div class="border-l-4 border-ods-13 pl-4 py-2">
                                        <div class="flex justify-between items-center mb-1">
                                            <span class="font-semibold">Efici√™ncia Energ√©tica</span>
                                            <span class="text-ods-13 font-bold">30</span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-2">
                                            <div class="bg-ods-13 h-2 rounded-full" style="width: 13%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Recent Reports -->
                        <div>
                            <h4 class="font-bold text-lg mb-4 text-deep-blue">Relatos Recentes</h4>
                            <div class="space-y-3">
                                <div class="flex items-start gap-4 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                                    <div class="text-2xl">üå≤</div>
                                    <div class="flex-1">
                                        <div class="font-semibold text-sm mb-1">√Årvores precisando de poda no Jardim Bot√¢nico</div>
                                        <div class="text-xs text-gray-600">Categoria: √Åreas Verdes ‚Ä¢ h√° 30 min</div>
                                    </div>
                                    <span class="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-xs font-bold">Em an√°lise</span>
                                </div>
                                
                                <div class="flex items-start gap-4 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                                    <div class="text-2xl">‚ôªÔ∏è</div>
                                    <div class="flex-1">
                                        <div class="font-semibold text-sm mb-1">Falta de lixeiras para reciclagem</div>
                                        <div class="text-xs text-gray-600">Categoria: Gest√£o de Res√≠duos ‚Ä¢ h√° 4 horas</div>
                                    </div>
                                    <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-xs font-bold">Em progresso</span>
                                </div>
                                
                                <div class="flex items-start gap-4 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                                    <div class="text-2xl">üè≠</div>
                                    <div class="flex-1">
                                        <div class="font-semibold text-sm mb-1">Polui√ß√£o do ar pr√≥ximo ao porto</div>
                                        <div class="text-xs text-gray-600">Categoria: Polui√ß√£o Ambiental ‚Ä¢ h√° 1 dia</div>
                                    </div>
                                    <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-xs font-bold">Resolvido</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Export Section -->
    <section class="py-12 bg-white">
        <div class="container mx-auto px-6 text-center">
            <h2 class="text-3xl font-bold font-poppins text-deep-blue mb-4">Exportar Relat√≥rios</h2>
            <p class="text-gray-600 mb-8">Baixe os dados completos para an√°lise detalhada (considera filtros ativos)</p>
            <div class="flex flex-wrap justify-center gap-4">
                <button id="export-excel-btn" class="bg-gradient-to-r from-deep-blue to-vibrant-teal text-white px-8 py-3 rounded-full font-bold hover:opacity-90 transition">
                    üìä Exportar Excel
                </button>
                <button id="export-pdf-btn" class="bg-gradient-to-r from-ods-green to-green-600 text-white px-8 py-3 rounded-full font-bold hover:opacity-90 transition">
                    üìÑ Exportar PDF
                </button>
                <button onclick="window.location.href='empresa-dashboard.html'" class="bg-gradient-to-r from-solar-yellow to-yellow-600 text-deep-blue px-8 py-3 rounded-full font-bold hover:opacity-90 transition">
                    üìà Dashboard Interativo
                </button>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-dark-gray text-white py-12">
        <div class="container mx-auto px-6">
            <div class="text-center">
                <p class="text-gray-400 font-roboto text-sm">
                    &copy; 2025 HubBS - Hackathon Construinova Litoral. Desenvolvido com üíô para construir o amanh√£.
                </p>
                <p class="text-gray-500 text-xs mt-2">
                    M√©tricas ODS alinhadas aos Objetivos de Desenvolvimento Sustent√°vel da ONU
                </p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <!-- Database e Auth -->
    <script type="module" src="../../assets/js/modules/database.js"></script>
    <script type="module" src="../../assets/js/modules/auth.js"></script>
    
    <!-- Menu Mobile - JavaScript Puro (executa primeiro) -->
    <script>
        // Menu Mobile - Executado imediatamente
        document.addEventListener('DOMContentLoaded', function() {
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const mobileMenu = document.getElementById('mobile-menu');
            
            console.log('üì± Inicializando Menu Mobile...');
            console.log('Bot√£o:', mobileMenuBtn);
            console.log('Menu:', mobileMenu);
            
            if (mobileMenuBtn && mobileMenu) {
                mobileMenuBtn.addEventListener('click', function() {
                    console.log('üîÑ Clique no bot√£o hamburger detectado!');
                    const isHidden = mobileMenu.classList.contains('hidden');
                    
                    if (isHidden) {
                        mobileMenu.classList.remove('hidden');
                        console.log('‚úÖ Menu ABERTO');
                    } else {
                        mobileMenu.classList.add('hidden');
                        console.log('‚úÖ Menu FECHADO');
                    }
                });
                console.log('‚úÖ Menu mobile configurado com sucesso!');
            } else {
                console.error('‚ùå ERRO: Elementos n√£o encontrados!', {
                    botao: mobileMenuBtn,
                    menu: mobileMenu
                });
            }
        });
    </script>
    
    <script type="module">
        import { auth } from '../../assets/js/modules/auth.js';

        // Verificar autentica√ß√£o
        window.addEventListener('DOMContentLoaded', function() {
            // Verifica se est√° autenticado
            if (!auth.isAuthenticated()) {
                console.log('‚ùå Usu√°rio n√£o autenticado, redirecionando...');
                window.location.href = '../auth/login.html';
                return;
            }

            const user = auth.getCurrentUser();
            
            // Verifica se √© empresa
            if (user.tipo !== 'empresa') {
                console.log('‚ùå Usu√°rio n√£o √© empresa, redirecionando...');
                window.location.href = '../sistema/dashboard.html';
                return;
            }

            // Atualizar mensagem de boas-vindas
            const welcomeMessage = document.getElementById('welcome-message');
            const welcomeMessageMobile = document.getElementById('welcome-message-mobile');
            
            if (user.nome) {
                const message = `Bem-vindo(a), ${user.nome}!`;
                if (welcomeMessage) welcomeMessage.textContent = message;
                if (welcomeMessageMobile) welcomeMessageMobile.textContent = message;
            }

            console.log('‚úÖ M√©tricas ODS carregadas para:', user.nome);

            // CONFIGURAR LOGOUT - VERS√ÉO SIMPLIFICADA E DIRETA
            const logoutBtn = document.getElementById('logout-btn');
            const logoutBtnMobile = document.getElementById('logout-btn-mobile');

            console.log('üîß Verificando bot√µes de logout...');
            console.log('Bot√£o desktop:', logoutBtn);
            console.log('Bot√£o mobile:', logoutBtnMobile);

            function doLogout() {
                console.log('üö™üö™üö™ LOGOUT INICIADO! üö™üö™üö™');
                
                try {
                    // Limpar tudo
                    console.log('Limpando localStorage...');
                    localStorage.clear();
                    
                    console.log('Limpando sessionStorage...');
                    sessionStorage.clear();
                    
                    console.log('‚úÖ Tudo limpo! Redirecionando...');
                    
                    // Redirecionar
                    window.location.href = '../auth/login.html';
                    
                } catch (error) {
                    console.error('Erro:', error);
                    // Tentar de qualquer forma
                    window.location.href = '../auth/login.html';
                }
            }

            if (logoutBtn) {
                console.log('‚úÖ Configurando bot√£o desktop...');
                logoutBtn.onclick = function(e) {
                    e.preventDefault();
                    console.log('CLIQUE NO BOT√ÉO DESKTOP DETECTADO!');
                    doLogout();
                    return false;
                };
            }
            
            if (logoutBtnMobile) {
                console.log('‚úÖ Configurando bot√£o mobile...');
                logoutBtnMobile.onclick = function(e) {
                    e.preventDefault();
                    console.log('CLIQUE NO BOT√ÉO MOBILE DETECTADO!');
                    doLogout();
                    return false;
                };
            }
            
            console.log('üéØ Configura√ß√£o de logout conclu√≠da!');
        });
    </script>

    <script>
        // ==========================================
        // SISTEMA DE FILTROS M√öLTIPLOS E DIN√ÇMICOS
        // ==========================================

        // Estado dos filtros
        // ==========================================

        // Estado dos filtros
        const filterState = {
            ods: 'all',
            city: 'all',
            period: 'month'
        };

        // Dados base por cidade e per√≠odo
        const cityDataByPeriod = {
            'santos': {
                'week': { ods9: 28, ods11: 47, ods13: 19, resolvidos9: 23, resolvidos11: 38, resolvidos13: 15, emProgresso9: 3, emProgresso11: 6, emProgresso13: 3, emAnalise9: 2, emAnalise11: 3, emAnalise13: 1 },
                'month': { ods9: 142, ods11: 234, ods13: 98, resolvidos9: 118, resolvidos11: 185, resolvidos13: 75, emProgresso9: 16, emProgresso11: 35, emProgresso13: 17, emAnalise9: 8, emAnalise11: 14, emAnalise13: 6 },
                'quarter': { ods9: 389, ods11: 645, ods13: 267, resolvidos9: 323, resolvidos11: 510, resolvidos13: 203, emProgresso9: 43, emProgresso11: 97, emProgresso13: 48, emAnalise9: 23, emAnalise11: 38, emAnalise13: 16 },
                'year': { ods9: 1456, ods11: 2401, ods13: 998, resolvidos9: 1208, resolvidos11: 1897, resolvidos13: 758, emProgresso9: 161, emProgresso11: 360, emProgresso13: 180, emAnalise9: 87, emAnalise11: 144, emAnalise13: 60 },
                'all-time': { ods9: 2834, ods11: 4678, ods13: 1945, resolvidos9: 2352, resolvidos11: 3696, resolvidos13: 1477, emProgresso9: 313, emProgresso11: 702, emProgresso13: 351, emAnalise9: 169, emAnalise11: 280, emAnalise13: 117 }
            },
            'sao-vicente': {
                'week': { ods9: 13, ods11: 22, ods13: 9, resolvidos9: 11, resolvidos11: 18, resolvidos13: 7, emProgresso9: 1, emProgresso11: 3, emProgresso13: 1, emAnalise9: 1, emAnalise11: 1, emAnalise13: 1 },
                'month': { ods9: 67, ods11: 112, ods13: 45, resolvidos9: 56, resolvidos11: 88, resolvidos13: 34, emProgresso9: 7, emProgresso11: 17, emProgresso13: 8, emAnalise9: 4, emAnalise11: 7, emAnalise13: 3 },
                'quarter': { ods9: 184, ods11: 308, ods13: 124, resolvidos9: 153, resolvidos11: 243, resolvidos13: 94, emProgresso9: 20, emProgresso11: 46, emProgresso13: 22, emAnalise9: 11, emAnalise11: 19, emAnalise13: 8 },
                'year': { ods9: 689, ods11: 1151, ods13: 463, resolvidos9: 572, resolvidos11: 909, resolvidos13: 352, emProgresso9: 76, emProgresso11: 173, emProgresso13: 83, emAnalise9: 41, emAnalise11: 69, emAnalise13: 28 },
                'all-time': { ods9: 1342, ods11: 2243, ods13: 902, resolvidos9: 1114, resolvidos11: 1772, resolvidos13: 686, emProgresso9: 148, emProgresso11: 337, emProgresso13: 162, emAnalise9: 80, emAnalise11: 134, emAnalise13: 54 }
            },
            'guaruja': {
                'week': { ods9: 11, ods11: 18, ods13: 8, resolvidos9: 9, resolvidos11: 14, resolvidos13: 6, emProgresso9: 1, emProgresso11: 3, emProgresso13: 1, emAnalise9: 1, emAnalise11: 1, emAnalise13: 1 },
                'month': { ods9: 54, ods11: 89, ods13: 38, resolvidos9: 45, resolvidos11: 70, resolvidos13: 29, emProgresso9: 6, emProgresso11: 13, emProgresso13: 7, emAnalise9: 3, emAnalise11: 6, emAnalise13: 2 },
                'quarter': { ods9: 148, ods11: 245, ods13: 104, resolvidos9: 123, resolvidos11: 194, resolvidos13: 79, emProgresso9: 16, emProgresso11: 37, emProgresso13: 19, emAnalise9: 9, emAnalise11: 14, emAnalise13: 6 },
                'year': { ods9: 554, ods11: 916, ods13: 389, resolvidos9: 460, resolvidos11: 724, resolvidos13: 296, emProgresso9: 61, emProgresso11: 137, emProgresso13: 70, emAnalise9: 33, emAnalise11: 55, emAnalise13: 23 },
                'all-time': { ods9: 1079, ods11: 1785, ods13: 758, resolvidos9: 896, resolvidos11: 1410, resolvidos13: 576, emProgresso9: 119, emProgresso11: 268, emProgresso13: 136, emAnalise9: 64, emAnalise11: 107, emAnalise13: 46 }
            },
            'praia-grande': {
                'week': { ods9: 8, ods11: 13, ods13: 5, resolvidos9: 7, resolvidos11: 10, resolvidos13: 4, emProgresso9: 1, emProgresso11: 2, emProgresso13: 1, emAnalise9: 0, emAnalise11: 1, emAnalise13: 0 },
                'month': { ods9: 38, ods11: 67, ods13: 24, resolvidos9: 32, resolvidos11: 53, resolvidos13: 18, emProgresso9: 4, emProgresso11: 10, emProgresso13: 4, emAnalise9: 2, emAnalise11: 4, emAnalise13: 2 },
                'quarter': { ods9: 104, ods11: 184, ods13: 66, resolvidos9: 86, resolvidos11: 145, resolvidos13: 50, emProgresso9: 11, emProgresso11: 28, emProgresso13: 12, emAnalise9: 7, emAnalise11: 11, emAnalise13: 4 },
                'year': { ods9: 389, ods11: 689, ods13: 247, resolvidos9: 323, resolvidos11: 544, resolvidos13: 188, emProgresso9: 43, emProgresso11: 103, emProgresso13: 44, emAnalise9: 23, emAnalise11: 42, emAnalise13: 15 },
                'all-time': { ods9: 758, ods11: 1342, ods13: 481, resolvidos9: 629, resolvidos11: 1060, resolvidos13: 366, emProgresso9: 84, emProgresso11: 201, emProgresso13: 86, emAnalise9: 45, emAnalise11: 81, emAnalise13: 29 }
            },
            'cubatao': {
                'week': { ods9: 5, ods11: 7, ods13: 3, resolvidos9: 4, resolvidos11: 6, resolvidos13: 2, emProgresso9: 1, emProgresso11: 1, emProgresso13: 1, emAnalise9: 0, emAnalise11: 0, emAnalise13: 0 },
                'month': { ods9: 23, ods11: 34, ods13: 15, resolvidos9: 19, resolvidos11: 27, resolvidos13: 11, emProgresso9: 3, emProgresso11: 5, emProgresso13: 3, emAnalise9: 1, emAnalise11: 2, emAnalise13: 1 },
                'quarter': { ods9: 63, ods11: 93, ods13: 41, resolvidos9: 52, resolvidos11: 73, resolvidos13: 31, emProgresso9: 7, emProgresso11: 14, emProgresso13: 7, emAnalise9: 4, emAnalise11: 6, emAnalise13: 3 },
                'year': { ods9: 236, ods11: 348, ods13: 153, resolvidos9: 196, resolvidos11: 275, resolvidos13: 116, emProgresso9: 26, emProgresso11: 52, emProgresso13: 28, emAnalise9: 14, emAnalise11: 21, emAnalise13: 9 },
                'all-time': { ods9: 460, ods11: 678, ods13: 298, resolvidos9: 382, resolvidos11: 536, resolvidos13: 226, emProgresso9: 51, emProgresso11: 102, emProgresso13: 54, emAnalise9: 27, emAnalise11: 40, emAnalise13: 18 }
            },
            'bertioga': {
                'week': { ods9: 2, ods11: 4, ods13: 2, resolvidos9: 2, resolvidos11: 3, resolvidos13: 2, emProgresso9: 0, emProgresso11: 1, emProgresso13: 0, emAnalise9: 0, emAnalise11: 0, emAnalise13: 0 },
                'month': { ods9: 12, ods11: 18, ods13: 8, resolvidos9: 10, resolvidos11: 14, resolvidos13: 6, emProgresso9: 1, emProgresso11: 3, emProgresso13: 1, emAnalise9: 1, emAnalise11: 1, emAnalise13: 1 },
                'quarter': { ods9: 33, ods11: 49, ods13: 22, resolvidos9: 27, resolvidos11: 39, resolvidos13: 17, emProgresso9: 4, emProgresso11: 7, emProgresso13: 4, emAnalise9: 2, emAnalise11: 3, emAnalise13: 1 },
                'year': { ods9: 123, ods11: 184, ods13: 82, resolvidos9: 102, resolvidos11: 145, resolvidos13: 62, emProgresso9: 14, emProgresso11: 28, emProgresso13: 15, emAnalise9: 7, emAnalise11: 11, emAnalise13: 5 },
                'all-time': { ods9: 240, ods11: 358, ods13: 160, resolvidos9: 199, resolvidos11: 283, resolvidos13: 122, emProgresso9: 27, emProgresso11: 54, emProgresso13: 29, emAnalise9: 14, emAnalise11: 21, emAnalise13: 9 }
            },
            'mongagua': {
                'week': { ods9: 1, ods11: 3, ods13: 1, resolvidos9: 1, resolvidos11: 2, resolvidos13: 1, emProgresso9: 0, emProgresso11: 1, emProgresso13: 0, emAnalise9: 0, emAnalise11: 0, emAnalise13: 0 },
                'month': { ods9: 6, ods11: 14, ods13: 4, resolvidos9: 5, resolvidos11: 11, resolvidos13: 3, emProgresso9: 1, emProgresso11: 2, emProgresso13: 1, emAnalise9: 0, emAnalise11: 1, emAnalise13: 0 },
                'quarter': { ods9: 16, ods11: 38, ods13: 11, resolvidos9: 13, resolvidos11: 30, resolvidos13: 8, emProgresso9: 2, emProgresso11: 6, emProgresso13: 2, emAnalise9: 1, emAnalise11: 2, emAnalise13: 1 },
                'year': { ods9: 60, ods11: 142, ods13: 41, resolvidos9: 50, resolvidos11: 112, resolvidos13: 31, emProgresso9: 7, emProgresso11: 21, emProgresso13: 7, emAnalise9: 3, emAnalise11: 9, emAnalise13: 3 },
                'all-time': { ods9: 117, ods11: 277, ods13: 80, resolvidos9: 97, resolvidos11: 219, resolvidos13: 61, emProgresso9: 13, emProgresso11: 42, emProgresso13: 14, emAnalise9: 7, emAnalise11: 16, emAnalise13: 5 }
            },
            'itanhaem': {
                'week': { ods9: 1, ods11: 2, ods13: 0, resolvidos9: 1, resolvidos11: 2, resolvidos13: 0, emProgresso9: 0, emProgresso11: 0, emProgresso13: 0, emAnalise9: 0, emAnalise11: 0, emAnalise13: 0 },
                'month': { ods9: 3, ods11: 9, ods13: 2, resolvidos9: 2, resolvidos11: 7, resolvidos13: 2, emProgresso9: 1, emProgresso11: 1, emProgresso13: 0, emAnalise9: 0, emAnalise11: 1, emAnalise13: 0 },
                'quarter': { ods9: 8, ods11: 25, ods13: 5, resolvidos9: 7, resolvidos11: 20, resolvidos13: 4, emProgresso9: 1, emProgresso11: 4, emProgresso13: 1, emAnalise9: 0, emAnalise11: 1, emAnalise13: 0 },
                'year': { ods9: 30, ods11: 93, ods13: 19, resolvidos9: 25, resolvidos11: 73, resolvidos13: 14, emProgresso9: 3, emProgresso11: 14, emProgresso13: 3, emAnalise9: 2, emAnalise11: 6, emAnalise13: 2 },
                'all-time': { ods9: 58, ods11: 181, ods13: 37, resolvidos9: 48, resolvidos11: 143, resolvidos13: 28, emProgresso9: 6, emProgresso11: 27, emProgresso13: 7, emAnalise9: 4, emAnalise11: 11, emAnalise13: 2 }
            },
            'peruibe': {
                'week': { ods9: 0, ods11: 1, ods13: 0, resolvidos9: 0, resolvidos11: 1, resolvidos13: 0, emProgresso9: 0, emProgresso11: 0, emProgresso13: 0, emAnalise9: 0, emAnalise11: 0, emAnalise13: 0 },
                'month': { ods9: 2, ods11: 5, ods13: 0, resolvidos9: 2, resolvidos11: 4, resolvidos13: 0, emProgresso9: 0, emProgresso11: 1, emProgresso13: 0, emAnalise9: 0, emAnalise11: 0, emAnalise13: 0 },
                'quarter': { ods9: 5, ods11: 14, ods13: 0, resolvidos9: 4, resolvidos11: 11, resolvidos13: 0, emProgresso9: 1, emProgresso11: 2, emProgresso13: 0, emAnalise9: 0, emAnalise11: 1, emAnalise13: 0 },
                'year': { ods9: 19, ods11: 52, ods13: 0, resolvidos9: 16, resolvidos11: 41, resolvidos13: 0, emProgresso9: 2, emProgresso11: 8, emProgresso13: 0, emAnalise9: 1, emAnalise11: 3, emAnalise13: 0 },
                'all-time': { ods9: 37, ods11: 101, ods13: 0, resolvidos9: 31, resolvidos11: 80, resolvidos13: 0, emProgresso9: 4, emProgresso11: 15, emProgresso13: 0, emAnalise9: 2, emAnalise11: 6, emAnalise13: 0 }
            }
        };

        const cityNames = {
            'santos': 'Santos',
            'sao-vicente': 'S√£o Vicente',
            'guaruja': 'Guaruj√°',
            'praia-grande': 'Praia Grande',
            'cubatao': 'Cubat√£o',
            'bertioga': 'Bertioga',
            'mongagua': 'Mongagu√°',
            'itanhaem': 'Itanha√©m',
            'peruibe': 'Peru√≠be'
        };

        const periodNames = {
            'week': '√∫ltima semana',
            'month': '√∫ltimo m√™s',
            'quarter': '√∫ltimo trimestre',
            'year': '√∫ltimo ano',
            'all-time': 'todo o per√≠odo'
        };

        // Fun√ß√£o para obter dados filtrados
        function getFilteredMetrics() {
            const period = filterState.period;
            const city = filterState.city;
            const ods = filterState.ods;

            let metrics = {
                ods9: { total: 0, resolvidos: 0, emProgresso: 0, emAnalise: 0 },
                ods11: { total: 0, resolvidos: 0, emProgresso: 0, emAnalise: 0 },
                ods13: { total: 0, resolvidos: 0, emProgresso: 0, emAnalise: 0 }
            };

            if (city === 'all') {
                // Somar todas as cidades
                Object.keys(cityDataByPeriod).forEach(cityKey => {
                    const cityData = cityDataByPeriod[cityKey][period];
                    metrics.ods9.total += cityData.ods9;
                    metrics.ods9.resolvidos += cityData.resolvidos9;
                    metrics.ods9.emProgresso += cityData.emProgresso9;
                    metrics.ods9.emAnalise += cityData.emAnalise9;

                    metrics.ods11.total += cityData.ods11;
                    metrics.ods11.resolvidos += cityData.resolvidos11;
                    metrics.ods11.emProgresso += cityData.emProgresso11;
                    metrics.ods11.emAnalise += cityData.emAnalise11;

                    metrics.ods13.total += cityData.ods13;
                    metrics.ods13.resolvidos += cityData.resolvidos13;
                    metrics.ods13.emProgresso += cityData.emProgresso13;
                    metrics.ods13.emAnalise += cityData.emAnalise13;
                });
            } else {
                // Dados de uma cidade espec√≠fica
                const cityData = cityDataByPeriod[city][period];
                metrics.ods9.total = cityData.ods9;
                metrics.ods9.resolvidos = cityData.resolvidos9;
                metrics.ods9.emProgresso = cityData.emProgresso9;
                metrics.ods9.emAnalise = cityData.emAnalise9;

                metrics.ods11.total = cityData.ods11;
                metrics.ods11.resolvidos = cityData.resolvidos11;
                metrics.ods11.emProgresso = cityData.emProgresso11;
                metrics.ods11.emAnalise = cityData.emAnalise11;

                metrics.ods13.total = cityData.ods13;
                metrics.ods13.resolvidos = cityData.resolvidos13;
                metrics.ods13.emProgresso = cityData.emProgresso13;
                metrics.ods13.emAnalise = cityData.emAnalise13;
            }

            return metrics;
        }

        // Elementos
        const odsFilterButtons = document.querySelectorAll('.ods-filter-btn');
        const cityFilter = document.getElementById('city-filter');
        const periodFilter = document.getElementById('period-filter');
        const metricSections = document.querySelectorAll('.metric-section');
        const activeFiltersDiv = document.getElementById('active-filters');
        const filterTagsDiv = document.getElementById('filter-tags');
        const clearFiltersBtn = document.getElementById('clear-filters');
        const resultsCount = document.getElementById('results-count');
        const filterDescription = document.getElementById('filter-description');
        const refreshDataBtn = document.getElementById('refresh-data');

        // Fun√ß√£o para atualizar tags de filtros ativos
        function updateFilterTags() {
            filterTagsDiv.innerHTML = '';
            let hasActiveFilters = false;

            // ODS filter tag
            if (filterState.ods !== 'all') {
                hasActiveFilters = true;
                const tag = createFilterTag('ODS', filterState.ods.toUpperCase().replace('-', ' '), () => {
                    filterState.ods = 'all';
                    odsFilterButtons.forEach(b => b.classList.remove('active'));
                    document.querySelector('[data-ods="all"]').classList.add('active');
                    applyFilters();
                });
                filterTagsDiv.appendChild(tag);
            }

            // City filter tag
            if (filterState.city !== 'all') {
                hasActiveFilters = true;
                const tag = createFilterTag('Cidade', cityNames[filterState.city], () => {
                    filterState.city = 'all';
                    cityFilter.value = 'all';
                    applyFilters();
                });
                filterTagsDiv.appendChild(tag);
            }

            // Period filter tag
            if (filterState.period !== 'month') {
                hasActiveFilters = true;
                const tag = createFilterTag('Per√≠odo', periodNames[filterState.period], () => {
                    filterState.period = 'month';
                    periodFilter.value = 'month';
                    applyFilters();
                });
                filterTagsDiv.appendChild(tag);
            }

            // Show/hide active filters section
            if (hasActiveFilters) {
                activeFiltersDiv.classList.add('show');
                activeFiltersDiv.classList.remove('hidden');
            } else {
                activeFiltersDiv.classList.remove('show');
                activeFiltersDiv.classList.add('hidden');
            }
        }

        // Criar tag de filtro
        function createFilterTag(label, value, onRemove) {
            const tag = document.createElement('div');
            tag.className = 'filter-tag';
            tag.innerHTML = `
                ${label}: ${value}
                <button onclick="event.stopPropagation()">‚úï</button>
            `;
            tag.querySelector('button').addEventListener('click', (e) => {
                e.preventDefault();
                onRemove();
            });
            return tag;
        }

        // Aplicar filtros
        function applyFilters() {
            // Mostrar/ocultar se√ß√µes baseado no filtro ODS
            metricSections.forEach(section => {
                const odsType = section.getAttribute('data-ods');
                
                if (filterState.ods === 'all') {
                    section.style.display = 'block';
                } else {
                    section.style.display = odsType === filterState.ods ? 'block' : 'none';
                }
            });

            // Atualizar valores das m√©tricas
            updateMetricsDisplay();

            // Atualizar contagem de resultados
            updateResultsCount();

            // Atualizar tags de filtros
            updateFilterTags();

            // Atualizar descri√ß√£o
            updateFilterDescription();

            // Atualizar gr√°ficos
            updateCharts();

            console.log('Filtros aplicados:', filterState);
        }

        // Atualizar display das m√©tricas
        function updateMetricsDisplay() {
            const metrics = getFilteredMetrics();

            // Atualizar ODS 9
            const ods9Total = document.querySelector('[data-ods="ods-9"] .text-5xl.font-bold');
            const ods9Resolvidos = document.querySelectorAll('[data-ods="ods-9"] .text-2xl.font-bold')[0];
            const ods9Progresso = document.querySelectorAll('[data-ods="ods-9"] .text-2xl.font-bold')[1];
            const ods9Analise = document.querySelectorAll('[data-ods="ods-9"] .text-2xl.font-bold')[2];

            if (ods9Total) ods9Total.textContent = metrics.ods9.total.toLocaleString('pt-BR');
            if (ods9Resolvidos) ods9Resolvidos.textContent = metrics.ods9.resolvidos.toLocaleString('pt-BR');
            if (ods9Progresso) ods9Progresso.textContent = metrics.ods9.emProgresso.toLocaleString('pt-BR');
            if (ods9Analise) ods9Analise.textContent = metrics.ods9.emAnalise.toLocaleString('pt-BR');

            // Atualizar ODS 11
            const ods11Total = document.querySelector('[data-ods="ods-11"] .text-5xl.font-bold');
            const ods11Resolvidos = document.querySelectorAll('[data-ods="ods-11"] .text-2xl.font-bold')[0];
            const ods11Progresso = document.querySelectorAll('[data-ods="ods-11"] .text-2xl.font-bold')[1];
            const ods11Analise = document.querySelectorAll('[data-ods="ods-11"] .text-2xl.font-bold')[2];

            if (ods11Total) ods11Total.textContent = metrics.ods11.total.toLocaleString('pt-BR');
            if (ods11Resolvidos) ods11Resolvidos.textContent = metrics.ods11.resolvidos.toLocaleString('pt-BR');
            if (ods11Progresso) ods11Progresso.textContent = metrics.ods11.emProgresso.toLocaleString('pt-BR');
            if (ods11Analise) ods11Analise.textContent = metrics.ods11.emAnalise.toLocaleString('pt-BR');

            // Atualizar ODS 13
            const ods13Total = document.querySelector('[data-ods="ods-13"] .text-5xl.font-bold');
            const ods13Resolvidos = document.querySelectorAll('[data-ods="ods-13"] .text-2xl.font-bold')[0];
            const ods13Progresso = document.querySelectorAll('[data-ods="ods-13"] .text-2xl.font-bold')[1];
            const ods13Analise = document.querySelectorAll('[data-ods="ods-13"] .text-2xl.font-bold')[2];

            if (ods13Total) ods13Total.textContent = metrics.ods13.total.toLocaleString('pt-BR');
            if (ods13Resolvidos) ods13Resolvidos.textContent = metrics.ods13.resolvidos.toLocaleString('pt-BR');
            if (ods13Progresso) ods13Progresso.textContent = metrics.ods13.emProgresso.toLocaleString('pt-BR');
            if (ods13Analise) ods13Analise.textContent = metrics.ods13.emAnalise.toLocaleString('pt-BR');
        }

        // Atualizar contagem de resultados
        function updateResultsCount() {
            const metrics = getFilteredMetrics();
            let count = 0;

            if (filterState.ods === 'all') {
                count = metrics.ods9.total + metrics.ods11.total + metrics.ods13.total;
            } else if (filterState.ods === 'ods-9') {
                count = metrics.ods9.total;
            } else if (filterState.ods === 'ods-11') {
                count = metrics.ods11.total;
            } else if (filterState.ods === 'ods-13') {
                count = metrics.ods13.total;
            }

            resultsCount.textContent = count.toLocaleString('pt-BR');
        }

        // Atualizar descri√ß√£o dos filtros
        function updateFilterDescription() {
            let parts = [];

            if (filterState.city !== 'all') {
                parts.push(`em ${cityNames[filterState.city]}`);
            }

            if (filterState.ods !== 'all') {
                parts.push(`categorizados em ${filterState.ods.toUpperCase().replace('-', ' ')}`);
            }

            if (filterState.period !== 'month') {
                parts.push(`no per√≠odo: ${periodNames[filterState.period]}`);
            }

            filterDescription.textContent = parts.length > 0 ? ` (${parts.join(', ')})` : '';
        }

        // Event Listeners para ODS
        odsFilterButtons.forEach(btn => {
            btn.addEventListener('click', function() {
                odsFilterButtons.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                filterState.ods = this.getAttribute('data-ods');
                applyFilters();
            });
        });

        // Event Listener para Cidade
        if (cityFilter) {
            cityFilter.addEventListener('change', function() {
                filterState.city = this.value;
                applyFilters();
            });
        }

        // Event Listener para Per√≠odo
        if (periodFilter) {
            periodFilter.addEventListener('change', function() {
                filterState.period = this.value;
                applyFilters();
            });
        }

        // Limpar todos os filtros
        if (clearFiltersBtn) {
            clearFiltersBtn.addEventListener('click', function() {
                // Reset ODS
                filterState.ods = 'all';
                odsFilterButtons.forEach(b => b.classList.remove('active'));
                document.querySelector('[data-ods="all"]').classList.add('active');

                // Reset City
                filterState.city = 'all';
                cityFilter.value = 'all';

                // Reset Period
                filterState.period = 'month';
                periodFilter.value = 'month';

                applyFilters();
            });
        }

        // Atualizar dados
        if (refreshDataBtn) {
            refreshDataBtn.addEventListener('click', function() {
                this.innerHTML = '‚è≥ Atualizando...';
                setTimeout(() => {
                    this.innerHTML = 'üîÑ Atualizar dados';
                    applyFilters();
                    // Aqui voc√™ faria uma chamada real √† API
                }, 1000);
            });
        }

        // Create Charts
        let chartOds9Instance = null;
        let chartOds11Instance = null;
        let chartOds13Instance = null;

        function createChart(canvasId, labels, data, backgroundColor) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return null;

            return new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: backgroundColor,
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                font: {
                                    size: 12
                                }
                            }
                        }
                    }
                }
            });
        }

        // Fun√ß√£o para atualizar gr√°ficos
        function updateCharts() {
            const metrics = getFilteredMetrics();

            // Atualizar gr√°fico ODS 9
            if (chartOds9Instance) {
                chartOds9Instance.data.datasets[0].data = [
                    metrics.ods9.resolvidos,
                    metrics.ods9.emProgresso,
                    metrics.ods9.emAnalise
                ];
                chartOds9Instance.update();
            }

            // Atualizar gr√°fico ODS 11
            if (chartOds11Instance) {
                chartOds11Instance.data.datasets[0].data = [
                    metrics.ods11.resolvidos,
                    metrics.ods11.emProgresso,
                    metrics.ods11.emAnalise
                ];
                chartOds11Instance.update();
            }

            // Atualizar gr√°fico ODS 13
            if (chartOds13Instance) {
                chartOds13Instance.data.datasets[0].data = [
                    metrics.ods13.resolvidos,
                    metrics.ods13.emProgresso,
                    metrics.ods13.emAnalise
                ];
                chartOds13Instance.update();
            }
        }

        // Initialize Charts when DOM is loaded
        window.addEventListener('load', function() {
            const metrics = getFilteredMetrics();

            // ODS 9 Chart
            chartOds9Instance = createChart(
                'chart-ods9',
                ['Resolvidos', 'Em Progresso', 'Em An√°lise'],
                [metrics.ods9.resolvidos, metrics.ods9.emProgresso, metrics.ods9.emAnalise],
                ['#10b981', '#3b82f6', '#f59e0b']
            );

            // ODS 11 Chart
            chartOds11Instance = createChart(
                'chart-ods11',
                ['Resolvidos', 'Em Progresso', 'Em An√°lise'],
                [metrics.ods11.resolvidos, metrics.ods11.emProgresso, metrics.ods11.emAnalise],
                ['#10b981', '#3b82f6', '#f59e0b']
            );

            // ODS 13 Chart
            chartOds13Instance = createChart(
                'chart-ods13',
                ['Resolvidos', 'Em Progresso', 'Em An√°lise'],
                [metrics.ods13.resolvidos, metrics.ods13.emProgresso, metrics.ods13.emAnalise],
                ['#10b981', '#3b82f6', '#f59e0b']
            );

            // Aplicar filtros iniciais
            applyFilters();
        });
    </script>

    <!-- Script de Exporta√ß√£o PDF e Excel -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const exportPdfBtn = document.getElementById('export-pdf-btn');
            const exportExcelBtn = document.getElementById('export-excel-btn');

            // Fun√ß√£o para obter dados filtrados para exporta√ß√£o
            function getFilteredData() {
                const metrics = getFilteredMetrics();
                
                const data = {
                    filters: {
                        ods: filterState.ods,
                        city: filterState.city,
                        period: filterState.period
                    },
                    cityName: filterState.city !== 'all' ? cityNames[filterState.city] : 'Todas as cidades',
                    periodName: periodNames[filterState.period],
                    timestamp: new Date().toLocaleString('pt-BR'),
                    metrics: []
                };

                // Adicionar m√©tricas baseadas no filtro ODS
                if (filterState.ods === 'all' || filterState.ods === 'ods-6') {
                    data.metrics.push({
                        ods: 'ODS 6',
                        nome: '√Ågua Limpa e Saneamento',
                        total: 156,
                        resolvidos: 124,
                        emProgresso: 25,
                        emAnalise: 7
                    });
                }

                if (filterState.ods === 'all' || filterState.ods === 'ods-7') {
                    data.metrics.push({
                        ods: 'ODS 7',
                        nome: 'Energia Limpa e Acess√≠vel',
                        total: 203,
                        resolvidos: 167,
                        emProgresso: 28,
                        emAnalise: 8
                    });
                }

                if (filterState.ods === 'all' || filterState.ods === 'ods-9') {
                    data.metrics.push({
                        ods: 'ODS 9',
                        nome: 'Ind√∫stria, Inova√ß√£o e Infraestrutura',
                        total: metrics.ods9.total,
                        resolvidos: metrics.ods9.resolvidos,
                        emProgresso: metrics.ods9.emProgresso,
                        emAnalise: metrics.ods9.emAnalise
                    });
                }

                if (filterState.ods === 'all' || filterState.ods === 'ods-11') {
                    data.metrics.push({
                        ods: 'ODS 11',
                        nome: 'Cidades e Comunidades Sustent√°veis',
                        total: metrics.ods11.total,
                        resolvidos: metrics.ods11.resolvidos,
                        emProgresso: metrics.ods11.emProgresso,
                        emAnalise: metrics.ods11.emAnalise
                    });
                }

                if (filterState.ods === 'all' || filterState.ods === 'ods-12') {
                    data.metrics.push({
                        ods: 'ODS 12',
                        nome: 'Consumo e Produ√ß√£o Respons√°veis',
                        total: 289,
                        resolvidos: 231,
                        emProgresso: 44,
                        emAnalise: 14
                    });
                }

                if (filterState.ods === 'all' || filterState.ods === 'ods-13') {
                    data.metrics.push({
                        ods: 'ODS 13',
                        nome: 'A√ß√£o Contra a Mudan√ßa Global do Clima',
                        total: metrics.ods13.total,
                        resolvidos: metrics.ods13.resolvidos,
                        emProgresso: metrics.ods13.emProgresso,
                        emAnalise: metrics.ods13.emAnalise
                    });
                }

                return data;
            }

            // Exportar para PDF
            if (exportPdfBtn) {
                exportPdfBtn.addEventListener('click', function() {
                    console.log('üìÑ Exportando para PDF...');
                    
                    try {
                        const { jsPDF } = window.jspdf;
                        const doc = new jsPDF();
                        const data = getFilteredData();

                        // Configura√ß√µes
                        const pageWidth = doc.internal.pageSize.getWidth();
                        let yPos = 20;

                        // Cabe√ßalho
                        doc.setFillColor(0, 95, 115); // deep-blue
                        doc.rect(0, 0, pageWidth, 40, 'F');
                        
                        doc.setTextColor(255, 255, 255);
                        doc.setFontSize(22);
                        doc.setFont(undefined, 'bold');
                        doc.text('HubBS - M√©tricas ODS', pageWidth / 2, 15, { align: 'center' });
                        
                        doc.setFontSize(12);
                        doc.setFont(undefined, 'normal');
                        doc.text('Relat√≥rio de Desempenho Sustent√°vel', pageWidth / 2, 25, { align: 'center' });
                        doc.text(`Gerado em: ${data.timestamp}`, pageWidth / 2, 32, { align: 'center' });

                        yPos = 50;

                        // Informa√ß√µes de filtros
                        doc.setTextColor(0, 0, 0);
                        doc.setFontSize(11);
                        doc.setFont(undefined, 'bold');
                        doc.text('Filtros Aplicados:', 14, yPos);
                        
                        yPos += 7;
                        doc.setFont(undefined, 'normal');
                        doc.setFontSize(10);
                        doc.text(`‚Ä¢ Cidade: ${data.cityName}`, 14, yPos);
                        yPos += 6;
                        doc.text(`‚Ä¢ Per√≠odo: ${data.periodName}`, 14, yPos);
                        yPos += 6;
                        doc.text(`‚Ä¢ ODS: ${data.filters.ods === 'all' ? 'Todos' : data.filters.ods.toUpperCase().replace('-', ' ')}`, 14, yPos);
                        
                        yPos += 12;

                        // Tabela de m√©tricas
                        const tableData = data.metrics.map(m => [
                            m.ods,
                            m.nome,
                            m.total.toString(),
                            m.resolvidos.toString(),
                            m.emProgresso.toString(),
                            m.emAnalise.toString()
                        ]);

                        doc.autoTable({
                            startY: yPos,
                            head: [['ODS', 'Nome', 'Total', 'Resolvidos', 'Em Progresso', 'Em An√°lise']],
                            body: tableData,
                            theme: 'grid',
                            headStyles: {
                                fillColor: [0, 95, 115],
                                textColor: [255, 255, 255],
                                fontStyle: 'bold',
                                fontSize: 10
                            },
                            bodyStyles: {
                                fontSize: 9
                            },
                            alternateRowStyles: {
                                fillColor: [250, 243, 224]
                            },
                            columnStyles: {
                                0: { cellWidth: 20 },
                                1: { cellWidth: 70 },
                                2: { cellWidth: 20 },
                                3: { cellWidth: 25 },
                                4: { cellWidth: 30 },
                                5: { cellWidth: 25 }
                            }
                        });

                        // Resumo
                        yPos = doc.lastAutoTable.finalY + 15;
                        
                        if (yPos > 250) {
                            doc.addPage();
                            yPos = 20;
                        }

                        doc.setFontSize(11);
                        doc.setFont(undefined, 'bold');
                        doc.text('Resumo Geral:', 14, yPos);
                        
                        yPos += 7;
                        doc.setFont(undefined, 'normal');
                        doc.setFontSize(10);
                        
                        const totalGeral = data.metrics.reduce((sum, m) => sum + m.total, 0);
                        const totalResolvidos = data.metrics.reduce((sum, m) => sum + m.resolvidos, 0);
                        const totalProgresso = data.metrics.reduce((sum, m) => sum + m.emProgresso, 0);
                        const totalAnalise = data.metrics.reduce((sum, m) => sum + m.emAnalise, 0);
                        
                        doc.text(`‚Ä¢ Total de Registros: ${totalGeral}`, 14, yPos);
                        yPos += 6;
                        doc.text(`‚Ä¢ Resolvidos: ${totalResolvidos} (${((totalResolvidos/totalGeral)*100).toFixed(1)}%)`, 14, yPos);
                        yPos += 6;
                        doc.text(`‚Ä¢ Em Progresso: ${totalProgresso} (${((totalProgresso/totalGeral)*100).toFixed(1)}%)`, 14, yPos);
                        yPos += 6;
                        doc.text(`‚Ä¢ Em An√°lise: ${totalAnalise} (${((totalAnalise/totalGeral)*100).toFixed(1)}%)`, 14, yPos);

                        // Rodap√©
                        const pageCount = doc.internal.getNumberOfPages();
                        for (let i = 1; i <= pageCount; i++) {
                            doc.setPage(i);
                            doc.setFontSize(8);
                            doc.setTextColor(128, 128, 128);
                            doc.text(
                                `P√°gina ${i} de ${pageCount} - HubBS ¬© 2025 - Hackathon Construinova Litoral`,
                                pageWidth / 2,
                                doc.internal.pageSize.getHeight() - 10,
                                { align: 'center' }
                            );
                        }

                        // Salvar
                        const filename = `metricas-ods-${data.filters.city}-${data.filters.period}-${Date.now()}.pdf`;
                        doc.save(filename);
                        
                        console.log('‚úÖ PDF gerado com sucesso:', filename);
                        alert('‚úÖ Relat√≥rio PDF gerado com sucesso!');
                        
                    } catch (error) {
                        console.error('‚ùå Erro ao gerar PDF:', error);
                        alert('‚ùå Erro ao gerar PDF. Verifique o console para detalhes.');
                    }
                });
            }

            // Exportar para Excel
            if (exportExcelBtn) {
                exportExcelBtn.addEventListener('click', function() {
                    console.log('üìä Exportando para Excel...');
                    
                    try {
                        const data = getFilteredData();

                        // Criar workbook
                        const wb = XLSX.utils.book_new();

                        // Sheet 1: Informa√ß√µes gerais
                        const infoData = [
                            ['HubBS - M√©tricas ODS'],
                            ['Relat√≥rio de Desempenho Sustent√°vel'],
                            [''],
                            ['Gerado em:', data.timestamp],
                            [''],
                            ['FILTROS APLICADOS:'],
                            ['Cidade:', data.cityName],
                            ['Per√≠odo:', data.periodName],
                            ['ODS:', data.filters.ods === 'all' ? 'Todos' : data.filters.ods.toUpperCase().replace('-', ' ')],
                            ['']
                        ];
                        const ws1 = XLSX.utils.aoa_to_sheet(infoData);
                        XLSX.utils.book_append_sheet(wb, ws1, 'Informa√ß√µes');

                        // Sheet 2: M√©tricas detalhadas
                        const metricsData = [
                            ['ODS', 'Nome', 'Total', 'Resolvidos', 'Em Progresso', 'Em An√°lise', '% Resolvidos'],
                            ...data.metrics.map(m => [
                                m.ods,
                                m.nome,
                                m.total,
                                m.resolvidos,
                                m.emProgresso,
                                m.emAnalise,
                                `${((m.resolvidos / m.total) * 100).toFixed(1)}%`
                            ])
                        ];
                        const ws2 = XLSX.utils.aoa_to_sheet(metricsData);
                        
                        // Ajustar largura das colunas
                        ws2['!cols'] = [
                            { wch: 10 },
                            { wch: 45 },
                            { wch: 10 },
                            { wch: 12 },
                            { wch: 15 },
                            { wch: 12 },
                            { wch: 15 }
                        ];
                        
                        XLSX.utils.book_append_sheet(wb, ws2, 'M√©tricas Detalhadas');

                        // Sheet 3: Resumo
                        const totalGeral = data.metrics.reduce((sum, m) => sum + m.total, 0);
                        const totalResolvidos = data.metrics.reduce((sum, m) => sum + m.resolvidos, 0);
                        const totalProgresso = data.metrics.reduce((sum, m) => sum + m.emProgresso, 0);
                        const totalAnalise = data.metrics.reduce((sum, m) => sum + m.emAnalise, 0);

                        const resumoData = [
                            ['RESUMO GERAL'],
                            [''],
                            ['Indicador', 'Valor', 'Percentual'],
                            ['Total de Registros', totalGeral, '100%'],
                            ['Resolvidos', totalResolvidos, `${((totalResolvidos/totalGeral)*100).toFixed(1)}%`],
                            ['Em Progresso', totalProgresso, `${((totalProgresso/totalGeral)*100).toFixed(1)}%`],
                            ['Em An√°lise', totalAnalise, `${((totalAnalise/totalGeral)*100).toFixed(1)}%`],
                            [''],
                            ['Taxa de Resolu√ß√£o', `${((totalResolvidos/totalGeral)*100).toFixed(1)}%`],
                            ['Taxa de Pend√™ncia', `${(((totalProgresso+totalAnalise)/totalGeral)*100).toFixed(1)}%`]
                        ];
                        const ws3 = XLSX.utils.aoa_to_sheet(resumoData);
                        ws3['!cols'] = [{ wch: 20 }, { wch: 15 }, { wch: 15 }];
                        XLSX.utils.book_append_sheet(wb, ws3, 'Resumo');

                        // Sheet 4: Dados por cidade (mostra dados do per√≠odo selecionado)
                        if (filterState.city === 'all') {
                            const period = filterState.period;
                            const cidadesData = [
                                ['Cidade', 'ODS 9 Total', 'ODS 9 Resolvidos', 'ODS 11 Total', 'ODS 11 Resolvidos', 'ODS 13 Total', 'ODS 13 Resolvidos', 'Total Geral'],
                                ...Object.entries(cityDataByPeriod).map(([key, periods]) => {
                                    const periodData = periods[period];
                                    const totalGeral = periodData.ods9 + periodData.ods11 + periodData.ods13;
                                    return [
                                        cityNames[key],
                                        periodData.ods9,
                                        periodData.resolvidos9,
                                        periodData.ods11,
                                        periodData.resolvidos11,
                                        periodData.ods13,
                                        periodData.resolvidos13,
                                        totalGeral
                                    ];
                                })
                            ];
                            const ws4 = XLSX.utils.aoa_to_sheet(cidadesData);
                            ws4['!cols'] = [
                                { wch: 20 }, // Cidade
                                { wch: 12 }, // ODS 9 Total
                                { wch: 16 }, // ODS 9 Resolvidos
                                { wch: 12 }, // ODS 11 Total
                                { wch: 16 }, // ODS 11 Resolvidos
                                { wch: 12 }, // ODS 13 Total
                                { wch: 16 }, // ODS 13 Resolvidos
                                { wch: 12 }  // Total Geral
                            ];
                            XLSX.utils.book_append_sheet(wb, ws4, 'Dados por Cidade');
                        }

                        // Salvar
                        const filename = `metricas-ods-${data.filters.city}-${data.filters.period}-${Date.now()}.xlsx`;
                        XLSX.writeFile(wb, filename);
                        
                        console.log('‚úÖ Excel gerado com sucesso:', filename);
                        alert('‚úÖ Relat√≥rio Excel gerado com sucesso!');
                        
                    } catch (error) {
                        console.error('‚ùå Erro ao gerar Excel:', error);
                        alert('‚ùå Erro ao gerar Excel. Verifique o console para detalhes.');
                    }
                });
            }

            console.log('‚úÖ Bot√µes de exporta√ß√£o configurados!');
        });
    </script>
</body>
</html>

